<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Your Perfect Muay ThaiGym - AI Powered</title>

    <!-- Design System: Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700;800&family=Playfair+Display:ital,wght@1,400;1,700&display=swap"
        rel="stylesheet">

    <!-- Swiper CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <!-- Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Manrope', 'sans-serif'],

                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9', // Sky blue primary
                            600: '#0284c7',
                            900: '#0c4a6e',
                        },
                        dark: {
                            900: '#080808',
                            800: '#121212',
                            700: '#1E1E1E'
                        }
                    },
                    'fade-in': 'fadeIn 0.5s ease-out forwards',
                    'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
                    'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    'glow-pulse': 'glowPulse 2s ease-in-out infinite',
                    'shimmer': 'shimmer 3s linear infinite',
                    'typewriter': 'typewriter 2s steps(20) forwards',
                    'cursor-blink': 'cursorBlink 1s step-end infinite',
                    'progress-load': 'progressLoad 2s ease-out forwards',
                    'slide-up-fade': 'slideUpFade 0.5s ease-out forwards',
                    'slide-up-wait': 'slideUpWait 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards',
                    'pulse-blue': 'pulseBlue 2s ease-in-out infinite',
                },
                keyframes: {
                    fadeIn: {
                        '0%': { opacity: '0' },
                        '100%': { opacity: '1' },
                    },
                    fadeInUp: {
                        '0%': { opacity: '0', transform: 'translateY(20px)' },
                        '100%': { opacity: '1', transform: 'translateY(0)' },
                    },
                    glowPulse: {
                        '0%, 100%': { opacity: '1', transform: 'scale(1)' },
                        '50%': { opacity: '0.8', transform: 'scale(1.05)' },
                    },
                    shimmer: {
                        from: { backgroundPosition: '0 0' },
                        to: { backgroundPosition: '-200% 0' },
                    },
                    typewriter: {
                        from: { width: '0' },
                        to: { width: '100%' }
                    },
                    cursorBlink: {
                        '0%, 100%': { opacity: '1' },
                        '50%': { opacity: '0' }
                    },
                    progressLoad: {
                        '0%': { width: '0%' },
                        '100%': { width: '100%' }
                    },
                    slideUpFade: {
                        '0%': { opacity: '0', transform: 'translateY(10px)' },
                        '100%': { opacity: '1', transform: 'translateY(0)' }
                    },
                    slideUpWait: {
                        '0%': { opacity: '0', transform: 'translateY(20px)' },
                        '100%': { opacity: '1', transform: 'translateY(0)' }
                    },
                    pulseBlue: {
                        '0%, 100%': { boxShadow: '0 0 0 1px rgba(59, 130, 246, 0.5), 0 0 10px rgba(59, 130, 246, 0.3)' },
                        '50%': { boxShadow: '0 0 0 1px rgba(59, 130, 246, 0.8), 0 0 25px rgba(59, 130, 246, 0.6)' },
                    }
                }
            }
        }
    </script>

    <style>
        /* Hide scrollbar for Chrome, Safari and Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for IE, Edge and Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        body {
            background-color: #050505;
            color: #ffffff;
            -webkit-font-smoothing: antialiased;
        }

        .italic {
            font-family: 'Playfair Display', serif !important;
        }

        .glass-nav {
            background: rgba(5, 5, 5, 0.7);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .text-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #a5b4fc 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Shimmer Effect */
        @keyframes shimmer {
            0% {
                background-position: 200% 0;
            }

            100% {
                background-position: -200% 0;
            }
        }

        .animate-shimmer {
            animation: shimmer 6s linear infinite;
        }

        /* Swiper Linear Transition for Marquee Effect */
        .swiper-wrapper {
            transition-timing-function: linear;
        }
    </style>
</head>

<body class="relative">
    <!-- Founding 500 Waitlist Modal -->
    <div id="exclusive-invite-modal"
        style="display: none !important; position: fixed !important; inset: 0 !important; z-index: 2147483647 !important; background: rgba(0, 0, 0, 0.9) !important; backdrop-filter: blur(12px) !important; -webkit-backdrop-filter: blur(12px) !important; align-items: center !important; justify-content: center !important; padding: 1rem !important;">

        <div
            class="w-full max-w-2xl bg-zinc-950 border border-blue-500 rounded-2xl shadow-[0_0_50px_-10px_rgba(59,130,246,0.3)] relative overflow-hidden flex flex-col p-8">

            <!-- Close Button -->
            <button onclick="closeExclusiveInviteModal()"
                class="absolute top-4 right-4 text-zinc-500 hover:text-white transition-colors z-20">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <!-- Content -->
            <div id="founding-content">
                <h2 class="text-3xl font-bold text-white mb-4 leading-tight">The 2026 Fighter‚Äôs Season Pass</h2>
                <p class="text-zinc-400 text-base leading-relaxed mb-10">
                    Avoid tourist pricing. Get direct access to local rates, unblurred maps, and verified contacts for
                    200+ gyms.
                </p>

                <!-- Feature List -->
                <div class="space-y-5 mb-10">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-6 h-6 rounded-full border-2 border-blue-500 flex items-center justify-center shrink-0">
                            <i data-lucide="check" class="w-4 h-4 text-blue-400"></i>
                        </div>
                        <span class="text-white text-lg font-medium">Unblurred Maps & Locations</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-6 h-6 flex items-center justify-center shrink-0">
                            <i data-lucide="message-square" class="w-6 h-6 text-blue-400"></i>
                        </div>
                        <span class="text-white text-lg font-medium">Verified Local Pricing (No Tourist Tax)</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-6 h-6 flex items-center justify-center shrink-0">
                            <i data-lucide="phone" class="w-6 h-6 text-blue-400"></i>
                        </div>
                        <span class="text-white text-lg font-medium">Direct Owner Contacts</span>
                    </div>
                </div>

                <form id="founding-form" class="space-y-4">
                    <div>
                        <input type="text" id="founding-name" required placeholder="Enter your name"
                            class="w-full bg-black border border-zinc-800 rounded-xl px-4 py-3.5 text-white placeholder-zinc-600 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all">
                    </div>
                    <div>
                        <input type="email" id="founding-email" required placeholder="Enter your email"
                            class="w-full bg-black border border-zinc-800 rounded-xl px-4 py-3.5 text-white placeholder-zinc-600 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all">
                    </div>
                    <button type="submit" id="founding-submit-btn"
                        class="w-full bg-white hover:bg-zinc-200 text-black font-bold text-lg py-4 rounded-xl transition-all shadow-lg shadow-white/10 flex items-center justify-center gap-2">
                        <span>Join My Waitlist</span>
                    </button>
                    <p class="text-center text-zinc-500 text-xs uppercase tracking-widest font-medium">Pay when we
                        launch</p>
                </form>

                <!-- Success State -->
                <div id="founding-success" class="hidden flex-col items-center text-center py-4">
                    <div
                        class="w-16 h-16 rounded-full bg-blue-500/10 flex items-center justify-center mb-4 border border-blue-500/20">
                        <i data-lucide="check" class="w-8 h-8 text-blue-400"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Welcome to the Inner Circle.</h3>
                    <p class="text-zinc-400 text-sm leading-relaxed">
                        We just sent your confirmation to <span id="confirmed-email" class="text-white"></span>. The
                        Scout will be in touch soon.
                    </p>
                </div>
            </div>
        </div>
    </div>


    <!-- Navigation -->
    <!-- Navigation Wrapper -->
    <div class="fixed top-0 left-0 w-full z-50 flex flex-col font-sans">
        <!-- Beta Launch Banner -->

        <nav class="w-full glass-nav transition-all duration-300">
            <div class="max-w-7xl mx-auto px-6 h-20 flex items-center justify-center md:justify-between">
                <a href="#" class="flex items-center gap-2 group">

                    <span class="text-xl font-bold tracking-tight">Fightlore <span class="text-blue-500">+</span><span
                            class="inline-flex items-center gap-1 px-1.5 py-[1px] rounded-full border border-white/10 bg-white/5 text-[9px] font-bold text-blue-400 ml-1.5 align-middle leading-none"><span
                                class="relative flex h-1 w-1"><span
                                    class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span><span
                                    class="relative inline-flex rounded-full h-1 w-1 bg-blue-500"></span></span>BETA</span></span>
                </a>

                <div class="hidden md:flex items-center gap-8 text-sm font-medium text-zinc-400">
                    <a href="#features" class="hover:text-white transition-colors">How it Works</a>
                    <a href="#gyms" class="hover:text-white transition-colors">Verified Gyms</a>
                    <button onclick="openExclusiveInviteModal()"
                        class="hover:text-amber-400 text-amber-300 transition-colors font-semibold flex items-center gap-1">
                        Unlock the Season Pass <i data-lucide="lock" class="w-3 h-3"></i>
                    </button>
                    <a href="#faq" class="hover:text-white transition-colors">FAQ</a>
                </div>

                <div class="flex items-center gap-4">

                    <!-- Mobile Menu Button (Hidden) -->
                    <button id="mobile-menu-btn" class="hidden">
                        <!-- <i data-lucide="menu" class="w-6 h-6"></i> -->
                    </button>
                </div>
            </div>

            <!-- Mobile Menu Overlay -->
            <div id="mobile-menu"
                class="fixed inset-0 bg-black/95 backdrop-blur-xl z-40 hidden flex-col items-center justify-center gap-8 text-2xl font-medium transition-opacity duration-300">
                <button id="close-menu-btn" class="absolute top-6 right-6 text-zinc-400 hover:text-white">
                    <i data-lucide="x" class="w-8 h-8"></i>
                </button>
                <a href="#features" class="hover:text-blue-500 transition-colors" onclick="toggleMobileMenu()">How it
                    Works</a>
                <a href="#gyms" class="hover:text-blue-500 transition-colors" onclick="toggleMobileMenu()">Partner
                    Gyms</a>
                <a href="#faq" class="hover:text-blue-500 transition-colors" onclick="toggleMobileMenu()">FAQ</a>
                <button class="bg-blue-600 text-white px-8 py-3 rounded-lg text-lg mt-4"
                    onclick="toggleMobileMenu(); openExclusiveInviteModal()">Join Waitlist</button>
            </div>
        </nav>
    </div>

    <!-- Hero Section -->
    <header class="relative pt-44 pb-20 lg:pt-60 lg:pb-32 px-6 overflow-hidden">
        <!-- Background Glow -->
        <div
            class="absolute top-0 left-1/2 -translate-x-1/2 w-[1000px] h-[600px] bg-blue-600/20 rounded-full blur-[120px] -z-10 opacity-50">
        </div>

        <!-- Background Video -->
        <video autoplay muted loop playsinline class="absolute inset-0 w-full h-full object-cover -z-20">
            <source src="https://cdn.shopify.com/videos/c/o/v/c10b5f62496f4b26a181f5d8e7053c37.mp4">
        </video>
        <!-- Dark Overlay for Readability -->
        <div class="absolute inset-0 bg-black/40 -z-10"></div>
        <!-- Gradient Fade to Bottom -->
        <div class="absolute bottom-0 left-0 right-0 h-32 bg-gradient-to-b from-transparent to-[#050505] -z-10">
        </div>

        <div class="max-w-4xl mx-auto text-center">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-zinc-800 bg-zinc-900/50 text-xs font-medium text-blue-400 mb-8 animate-fade-in-up"
                style="animation-delay: 0.1s;">
                <span class="relative flex h-2 w-2">
                    <span
                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span>
                </span>
                200+ Hand-Verified Muay Thai Gyms
            </div>

            <h1 class="text-4xl md:text-7xl font-serif italic leading-[1.1] tracking-[-0.07em] mb-8 animate-fade-in-up"
                style="animation-delay: 0.2s;">
                AI-Powered Muay Thai<br>
                <span
                    class="animate-shimmer bg-[linear-gradient(110deg,#60a5fa,40%,#ffffff,50%,#60a5fa)] bg-[length:250%_100%] bg-clip-text text-transparent not-italic font-sans font-bold"
                    style="-webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Gym
                    Finder </span>
            </h1>

            <p class="text-xl text-white mb-10 max-w-4xl mx-auto leading-relaxed animate-fade-in-up"
                style="animation-delay: 0.3s;">
                <span class="md:hidden">Try 7 FREE AI searches to find gym</span>
                <span class="hidden md:inline">Try 7 FREE AI searches to find your perfect gym. Join the waitlist today
                    (no payment needed). <br>
                    When we launch, unlock 200+ verified gyms for just $29.</span>
            </p>

            <div class="flex flex-col sm:flex-row items-center justify-center gap-4 animate-fade-in-up"
                style="animation-delay: 0.4s;">
                <button onclick="openExclusiveInviteModal()"
                    class="w-full sm:w-auto px-8 py-4 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-semibold text-lg transition-all transform hover:scale-105 shadow-lg shadow-blue-900/20 flex items-center justify-center gap-2">
                    <i data-lucide="sparkles" class="w-5 h-5"></i>
                    Join Waitlist ‚Äî Pay $0 Now
                </button>

            </div>
        </div>
    </header>

    <!-- AI Chatbot Interface -->
    <div id="chatbot" class="relative max-w-4xl mx-auto px-6 mb-12 animate-fade-in-up" style="animation-delay: 0.6s;">


        <!-- New Dark Card -->
        <!-- Changed h-[750px] to h-auto and added id for expansion logic -->
        <div id="chatbot-inner-container"
            class="w-full flex flex-col h-auto transition-all duration-500 ease-in-out relative z-10">



            <!-- Chat History Area -->
            <!-- Added id and hidden class initially -->
            <div id="chat-history"
                class="hidden flex-1 overflow-y-auto p-6 space-y-6 scroll-smooth custom-scrollbar opacity-0 transition-opacity duration-300">
                <!-- Welcome Message -->
            </div>

            <!-- Input Area -->
            <div class="p-5">

                <!-- Suggestion Pills -->
                <div id="suggestion-pills" class="mb-4 flex flex-col items-center">
                    <div class="flex items-center gap-2 mb-3 px-1 opacity-70">
                        <i data-lucide="sparkles" class="w-3 h-3 text-blue-400"></i>
                        <span class="text-xs font-medium text-zinc-500 uppercase tracking-wide">Try asking...</span>
                    </div>
                    <div class="flex gap-3 overflow-x-auto pb-1 scrollbar-hide justify-center w-full">
                        <button type="button" onclick="expandChat()"
                            class="whitespace-nowrap px-4 py-2 rounded-lg bg-[#18181b]/80 border border-white/10 text-zinc-300 text-xs font-medium hover:bg-zinc-800 hover:text-white transition-all hover:border-zinc-600 backdrop-blur-sm">
                            <span class="mr-2">üèÜ</span> Best gyms in Bangkok?
                        </button>
                        <button type="button" onclick="expandChat()"
                            class="whitespace-nowrap px-4 py-2 rounded-lg bg-[#18181b]/80 border border-white/10 text-zinc-300 text-xs font-medium hover:bg-zinc-800 hover:text-white transition-all hover:border-zinc-600 backdrop-blur-sm">
                            <span class="mr-2">üìç</span> Where should I train?
                        </button>
                        <button type="button" onclick="expandChat()"
                            class="whitespace-nowrap px-4 py-2 rounded-lg bg-[#18181b]/80 border border-white/10 text-zinc-300 text-xs font-medium hover:bg-zinc-800 hover:text-white transition-all hover:border-zinc-600 backdrop-blur-sm">
                            <span class="mr-2">‚≠ê</span> Show me your top recommendations
                        </button>
                    </div>
                </div>

                <div id="chat-input-container" class="relative max-w-4xl mx-auto">
                    <form id="chat-form" class="relative group" onsubmit="expandChat(event)">
                        <!-- Removed expandChat() on focus -->
                        <input type="text" id="chat-input"
                            class="w-full bg-[#18181b] text-white placeholder-zinc-500 rounded-2xl py-4 pl-5 pr-14 border border-white/5 animate-pulse-blue focus:border-blue-500 focus:bg-[#202023] focus:outline-none transition-all text-sm font-medium"
                            placeholder="Ask anything about gyms in Thailand...">
                        <button type="submit"
                            class="absolute right-2 top-1/2 -translate-y-1/2 w-9 h-9 bg-blue-600 hover:bg-blue-500 text-white rounded-xl transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center shadow-lg shadow-blue-900/20">
                            <i data-lucide="arrow-up" class="w-5 h-5"></i>
                        </button>
                    </form>
                    <div class="text-center mt-3">
                        <p class="text-[10px] text-zinc-600 font-medium">AI may display inaccurate info. Always verify
                            booking details.</p>
                    </div>
                </div>

                <!-- Waitlist Prompt Card (Hidden by Default) -->
                <div id="chat-limit-prompt" class="hidden">
                    <div
                        class="bg-gradient-to-b from-[#18181b] to-[#09090b] border border-zinc-800 rounded-2xl p-6 text-center">
                        <div class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-blue-500/10 mb-4">
                            <i data-lucide="lock" class="w-5 h-5 text-blue-500"></i>
                        </div>
                        <h3 class="text-lg font-bold text-white mb-2">You've reached your free limit</h3>
                        <p class="text-zinc-400 text-sm mb-6 leading-relaxed max-w-xs mx-auto">
                            Join the waitlist to unlock unlimited AI searches and verified gym details.
                        </p>
                        <button onclick="openExclusiveInviteModal()"
                            class="w-full bg-blue-600 hover:bg-blue-500 text-white font-semibold py-3.5 rounded-lg transition-all shadow-lg shadow-blue-600/20 flex items-center justify-center gap-2 text-sm">
                            Join Waitlist - Unlock Full Access
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        function expandChat(event) {
            if (event) event.preventDefault();
            const container = document.getElementById('chatbot-inner-container');
            const history = document.getElementById('chat-history');

            // Add active frame styles
            container.classList.add('border', 'border-blue-500/30', 'bg-black/40', 'rounded-2xl', 'backdrop-blur-sm');

            // Expand height
            if (!container.classList.contains('h-[500px]')) {
                container.classList.remove('h-auto');
                container.classList.add('h-[500px]');

                // Show history with a slight delay for smooth transition
                setTimeout(() => {
                    history.classList.remove('hidden');
                    // Trigger reflow
                    void history.offsetWidth;
                    history.classList.remove('opacity-0');
                }, 150);
            }
        }

        function askAiAboutGym() {
            // 1. Get Gym Name
            const gymName = document.getElementById('modal-title')?.innerText || "this gym";

            // 2. Close Modal
            const modal = document.getElementById('video-modal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('flex');

                // Stop video if playing
                const v = document.getElementById('modal-video');
                if (v) v.pause();
            }

            // 3. Scroll to Chat
            const chatbot = document.getElementById('chatbot');
            if (chatbot) {
                chatbot.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // 4. Expand Chat
                setTimeout(() => {
                    expandChat();
                }, 500);

                // 5. Pre-fill Input
                const input = document.getElementById('chat-input');
                if (input) {
                    input.value = `Tell me more about ${gymName}`;
                    input.focus();
                }
            }
        }
    </script>

    <!-- Features Section -->
    <section id="features" class="py-24 bg-zinc-900/30 border-y border-zinc-800/50">
        <div class="max-w-7xl mx-auto px-6">
            <h2 class="text-4xl md:text-5xl font-serif italic mb-12">How It Works <span
                    class="not-italic font-sans font-bold text-white"></span></h2>
            <div class="md:grid md:grid-cols-2 gap-16 items-center">
                <div>
                    <p class="text-lg text-zinc-400 mb-8 leading-relaxed">
                        We built Thailand's most trusted Muay Thai gym database. Every gym is personally verified,
                        constantly updated, and checked for accuracy.
                    </p>

                    <ul class="space-y-8">
                        <!-- Step 1 -->
                        <li class="flex items-start gap-4">
                            <div
                                class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 shrink-0 mt-1">
                                <i data-lucide="ticket" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <span class="text-blue-500 font-bold text-xs tracking-wider uppercase mb-1 block">Step
                                    1</span>
                                <h3 class="text-xl font-bold text-white mb-2">Try the AI Scout For FREE</h3>
                                <p class="text-zinc-400 text-base leading-relaxed">
                                    Chat with our AI to find gyms that match your needs. You get 7 <span
                                        class="text-emerald-400">FREE</span> searches‚Äîno
                                    signup required. Ask about budget, location, amenities, or training style.
                                </p>
                            </div>
                        </li>

                        <!-- Step 2 -->
                        <li class="flex items-start gap-4">
                            <div
                                class="w-12 h-12 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-400 shrink-0 mt-1">
                                <i data-lucide="calendar-check" class="w-6 h-6"></i>
                            </div>
                            <div>
                                <span class="text-blue-500 font-bold text-xs tracking-wider uppercase mb-1 block">Step
                                    2</span>
                                <h3 class="text-xl font-bold text-white mb-2">Join the Waitlist</h3>
                                <p class="text-zinc-400 text-base leading-relaxed">
                                    Found gyms you like? Join the waitlist for $29 to unlock 200+ verified gyms,
                                    unlimited AI searches, real pricing, and full access valid for 12 months. Pay later
                                    when we
                                    launch‚Äî$0 today.
                                </p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="mt-12 md:mt-0 relative self-center">
                    <div class="absolute inset-0 bg-blue-500/10 blur-[80px] rounded-full"></div>
                    <div class="relative bg-black border border-zinc-800 rounded-xl overflow-hidden shadow-2xl group cursor-pointer"
                        id="vsl-trigger">
                        <div
                            class="absolute inset-0 bg-black/40 group-hover:bg-black/20 transition-colors z-10 flex items-center justify-center">
                            <div
                                class="w-16 h-16 rounded-full bg-blue-600/90 flex items-center justify-center text-white backdrop-blur-sm group-hover:scale-110 transition-transform shadow-lg shadow-blue-500/20">
                                <i data-lucide="play" class="w-6 h-6 ml-1 fill-current"></i>
                            </div>
                        </div>
                        <video autoplay muted loop playsinline
                            class="w-full h-full object-cover aspect-video opacity-80 group-hover:opacity-100 transition-opacity"
                            src="https://cdn.shopify.com/videos/c/o/v/48ec1e59d63740a1bd3b81486969da95.mp4">
                        </video>
                    </div>
                </div>
            </div>
        </div>
    </section>




    <!-- Gym Showcase Section (Infinite Loop + Video Hover) -->
    <section id="gyms" class="py-24 bg-black relative overflow-hidden">
        <!-- Background Gradient -->
        <div class="absolute top-0 right-0 w-1/2 h-full bg-blue-900/10 blur-[100px] pointer-events-none"></div>

        <div class="max-w-7xl mx-auto px-6 mb-12">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-8">
                <div>
                    <span class="text-blue-500 font-semibold tracking-wide uppercase text-sm">FIND YOUR MATCH</span>
                    <h2 class="text-4xl md:text-5xl font-serif italic mt-2">Explore Verified <span
                            class="not-italic font-sans font-bold text-white">Gyms</span></h2>
                    <p class="text-zinc-500 mt-4 max-w-xl">Meet the gyms we've personally verified. Hover over each gym
                        to watch video previews and see prices, training style, and atmosphere.</p>
                </div>

                <!-- Database Stats -->
                <div
                    class="bg-zinc-900/80 backdrop-blur-md border border-zinc-700/50 rounded-lg p-4 flex flex-col gap-1 min-w-[320px] shadow-xl">
                    <div class="flex items-center gap-3 mb-1">
                        <div class="relative flex h-2.5 w-2.5">
                            <span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2.5 w-2.5 bg-emerald-500"></span>
                        </div>
                        <span class="text-white font-medium tracking-tight">Viewing <span
                                class="text-emerald-400">5</span> of <span class="text-white">200+</span> Verified
                            Gyms</span>
                    </div>
                    <div class="text-xs text-zinc-500 border-t border-zinc-700/50 pt-3 mt-1 leading-relaxed">
                        <span class="text-zinc-300 font-medium">Next Uploads Adding Soon: </span>PK Saenchai,
                        Petchyindee Academy, Suablack
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Indicator (shown while fetching data) -->
        <div id="gym-loading" class="flex items-center justify-center py-20 w-full">
            <div class="flex flex-col items-center gap-6">
                <div class="relative w-16 h-16">
                    <div class="absolute inset-0 border-4 border-zinc-800 rounded-full"></div>
                    <div
                        class="absolute inset-0 border-4 border-transparent border-t-blue-500 rounded-full animate-spin">
                    </div>
                </div>
                <div class="text-center">
                    <p class="text-white text-base font-semibold mb-1">Loading Verified Gyms</p>
                    <p class="text-zinc-400 text-sm">Fetching data from our database...</p>
                </div>
            </div>
        </div>

        <!-- Swiper Container -->
        <div class="swiper mySwiper w-full px-6">
            <div class="swiper-wrapper">

                <!-- Gym cards will be dynamically generated from API -->


            </div>
        </div>



        <script>
            // Initialize Swiper
            const swiper = new Swiper('.mySwiper', {
                slidesPerView: 'auto',
                spaceBetween: 24,
                loop: true,
                loopedSlides: 8, // Force more duplicates for smooth loop
                speed: 6000, // Speed for linear movement
                autoplay: {
                    delay: 0,
                    disableOnInteraction: false,
                    pauseOnMouseEnter: true
                },
                freeMode: true,
                freeModeMomentum: false, // Disable momentum for linear feel
                grabCursor: true,
                allowTouchMove: true
            });

            // Video Hover & Click Logic (Event Delegation for Swiper Duplicates)
            const swiperWrapper = document.querySelector('.swiper-wrapper');

            // 1. Play/Pause on Hover - REMOVED (Conflicted with Best Bits Logic below)
            // Logic moved to gymContainer event delegation at bottom of file.

            // 2. Click to Open Modal logic is handled by gymContainer delegation below.
            // keeping this clean to avoid conflicts.
        </script>
    </section>



    <!-- FAQ Section -->
    <section id="faq" class="py-24 bg-zinc-900 border-t border-zinc-800">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-3xl md:text-5xl font-serif italic mb-12 text-center">Frequently Asked <span
                    class="not-italic font-sans font-bold">Questions</span></h2>

            <div class="space-y-4">
                <!-- Item 8 -->
                <details
                    class="group bg-black border border-zinc-800 rounded-xl overflow-hidden transition-all duration-300 open:pb-4">
                    <summary
                        class="flex items-center justify-between p-6 cursor-pointer list-none text-lg font-medium hover:text-blue-400 transition-colors">
                        <span>What happens after I join the waitlist?</span>
                        <span class="transition-transform group-open:rotate-180">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </span>
                    </summary>
                    <div class="px-6 text-zinc-400 leading-relaxed">
                        You'll get early access when we launch. We'll email you, and you can pay $29 then to unlock
                        everything. No payment needed today.
                    </div>
                </details>

                <!-- Item 1 -->
                <details
                    class="group bg-black border border-zinc-800 rounded-xl overflow-hidden transition-all duration-300 open:pb-4">
                    <summary
                        class="flex items-center justify-between p-6 cursor-pointer list-none text-lg font-medium hover:text-blue-400 transition-colors">
                        <span>Can I try it before paying?</span>
                        <span class="transition-transform group-open:rotate-180">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </span>
                    </summary>
                    <div class="px-6 text-zinc-400 leading-relaxed">
                        Yes! You get 7 <span class="text-emerald-400">FREE</span> AI gym searches. No credit card
                        needed. If you love it, join the waitlist
                        for $29 to unlock everything.
                    </div>
                </details>

                <!-- Item 2 -->
                <details
                    class="group bg-black border border-zinc-800 rounded-xl overflow-hidden transition-all duration-300 open:pb-4">
                    <summary
                        class="flex items-center justify-between p-6 cursor-pointer list-none text-lg font-medium hover:text-blue-400 transition-colors">
                        <span>How many gyms are in the database?</span>
                        <span class="transition-transform group-open:rotate-180">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </span>
                    </summary>
                    <div class="px-6 text-zinc-400 leading-relaxed">
                        We currently have 200+ verified gyms across Bangkok, Chiang Mai, Phuket, Pattaya, and Koh Samui.
                        We add 5-10 new gyms every week.
                    </div>
                </details>

                <!-- Item 3 -->
                <details
                    class="group bg-black border border-zinc-800 rounded-xl overflow-hidden transition-all duration-300 open:pb-4">
                    <summary
                        class="flex items-center justify-between p-6 cursor-pointer list-none text-lg font-medium hover:text-blue-400 transition-colors">
                        <span>What's included in the $29 pass?</span>
                        <span class="transition-transform group-open:rotate-180">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </span>
                    </summary>
                    <div class="px-6 text-zinc-400 leading-relaxed">
                        Full access to 200+ verified gyms (Black Book), 100 AI Scout credits, real gym pricing (no
                        tourist
                        markup), video tours, and verified contact info‚Äîvalid for 12 months.
                    </div>
                </details>

                <!-- Item 4 -->
                <details
                    class="group bg-black border border-zinc-800 rounded-xl overflow-hidden transition-all duration-300 open:pb-4">
                    <summary
                        class="flex items-center justify-between p-6 cursor-pointer list-none text-lg font-medium hover:text-blue-400 transition-colors">
                        <span>Do you add gyms in other cities?</span>
                        <span class="transition-transform group-open:rotate-180">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </span>
                    </summary>
                    <div class="px-6 text-zinc-400 leading-relaxed">
                        Yes! We're constantly adding new cities and gyms. Founding members get access to all new
                        additions free, forever.
                    </div>
                </details>

                <!-- Item 5 -->
                <details
                    class="group bg-black border border-zinc-800 rounded-xl overflow-hidden transition-all duration-300 open:pb-4">
                    <summary
                        class="flex items-center justify-between p-6 cursor-pointer list-none text-lg font-medium hover:text-blue-400 transition-colors">
                        <span>Is the pricing really accurate?</span>
                        <span class="transition-transform group-open:rotate-180">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </span>
                    </summary>
                    <div class="px-6 text-zinc-400 leading-relaxed">
                        Every gym is personally verified within the last 30 days. We check real drop-in fees and monthly
                        prices so you know exactly what to expect‚Äîno surprises.
                    </div>
                </details>

                <!-- Item 6 -->
                <!-- Item 7 -->
                <details
                    class="group bg-black border border-zinc-800 rounded-xl overflow-hidden transition-all duration-300 open:pb-4">
                    <summary
                        class="flex items-center justify-between p-6 cursor-pointer list-none text-lg font-medium hover:text-blue-400 transition-colors">
                        <span>Can I use this on my phone?</span>
                        <span class="transition-transform group-open:rotate-180">
                            <i data-lucide="chevron-down" class="w-5 h-5"></i>
                        </span>
                    </summary>
                    <div class="px-6 text-zinc-400 leading-relaxed">
                        Yes! Works perfectly on any device‚Äîphone, tablet, or computer.
                    </div>
                </details>


            </div>
            <p class="text-center text-zinc-500 mt-12">Have questions? We'd love to help - <a
                    href="mailto:infofightlore@gmail.com" class="text-blue-500 hover:underline">Email us</a></p>
        </div>
    </section>

    <!-- Pricing Section (2-Step Funnel) -->
    <section id="pricing" class="py-24 bg-black border-t border-zinc-800 relative overflow-hidden">
        <div class="max-w-5xl mx-auto px-6">
            <h2 class="text-3xl md:text-5xl font-serif italic mb-4 text-center">Simple Pricing ‚Äî <span
                    class="not-italic font-sans font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-200 to-white">Fast
                    & Easy</span></h2>
            <p class="text-zinc-400 text-center mb-16 text-lg max-w-2xl mx-auto">Try 7 <span
                    class="text-emerald-400">FREE</span> AI searches. Then unlock
                200+
                verified gyms for just $29.</p>

            <div class="grid md:grid-cols-2 gap-6 items-stretch">
                <!-- Step 1: Try Free -->
                <div class="relative group">
                    <div
                        class="absolute inset-0 bg-gradient-to-b from-white/5 to-transparent rounded-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500">
                    </div>
                    <div
                        class="relative h-full bg-[#0b0b0c] border border-white/10 rounded-xl p-8 flex flex-col items-center text-center gap-6 hover:border-zinc-700 transition-colors">
                        <div
                            class="inline-block px-3 py-1 rounded-full bg-zinc-900 border border-zinc-800 text-[10px] font-bold uppercase tracking-widest text-zinc-400">
                            FREE TRIAL</div>
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-2">Try the AI Scout Free</h3>
                            <p class="text-zinc-400 text-sm leading-relaxed mx-auto max-w-xs">Chat with our AI to find
                                gyms that match
                                what
                                you're
                                looking for. Get 7 <span class="text-emerald-400">FREE</span> searches</p>
                        </div>
                        <ul class="space-y-4 mt-2 inline-flex flex-col">
                            <li class="flex items-center gap-3 text-sm text-zinc-300">
                                <i data-lucide="search" class="w-5 h-5 text-zinc-500 shrink-0"></i>
                                <span>7 AI Gym Searches</span>
                            </li>
                            <li class="flex items-center gap-3 text-sm text-zinc-300">
                                <i data-lucide="credit-card" class="w-5 h-5 text-zinc-500 shrink-0"></i>
                                <span>No credit card needed</span>
                            </li>
                            <li class="flex items-center gap-3 text-sm text-zinc-300">
                                <i data-lucide="zap" class="w-5 h-5 text-zinc-500 shrink-0"></i>
                                <span>Instant Match Results</span>
                            </li>
                            <li class="flex items-center gap-3 text-sm text-zinc-300">
                                <i data-lucide="database" class="w-5 h-5 text-zinc-500 shrink-0"></i>
                                <span>Access to 10+ Gyms</span>
                            </li>
                            <li class="flex items-center gap-3 text-sm text-zinc-300">
                                <i data-lucide="smartphone" class="w-5 h-5 text-zinc-500 shrink-0"></i>
                                <span>Mobile Optimized</span>
                            </li>
                        </ul>
                        <div class="mt-auto w-full pt-6">
                            <div
                                class="w-full text-center py-3 rounded-xl border border-white/10 text-zinc-400 text-sm font-medium">
                                Current Status
                            </div>
                            <p class="text-center text-[10px] mt-3 uppercase tracking-wider opacity-0 select-none">
                                Spacer</p>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Unlock Everything -->
                <div class="relative group">
                    <div
                        class="absolute -inset-[1px] bg-gradient-to-b from-blue-500 to-indigo-600 rounded-xl opacity-20 blur-lg group-hover:opacity-40 transition-opacity duration-500">
                    </div>
                    <div
                        class="relative h-full bg-[#08080a] border border-blue-500/30 rounded-xl p-8 flex flex-col items-center text-center gap-6 shadow-2xl shadow-blue-900/10">
                        <div class="flex items-center justify-center w-full">
                            <div
                                class="inline-block px-3 py-1 rounded-full bg-blue-900/30 border border-blue-500/30 text-[10px] font-bold uppercase tracking-widest text-blue-400">
                                FULL ACCESS</div>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-2">$29 Founding Member Pass</h3>

                            <p class="text-blue-200/60 text-sm leading-relaxed mx-auto max-w-xs">Everything you need for
                                the ultimate
                                Thailand training trip.</p>
                        </div>
                        <ul class="space-y-4 mt-2 inline-flex flex-col">
                            <li class="flex items-center gap-3 text-sm text-white font-medium">
                                <i data-lucide="check-circle-2" class="w-5 h-5 text-blue-400 shrink-0"></i>
                                <span>200+ hand verified gyms </span>
                            </li>
                            <li class="flex items-center gap-3 text-sm text-white font-medium">
                                <i data-lucide="infinity" class="w-5 h-5 text-blue-400 shrink-0"></i>
                                <span>150 AI Scout credits</span>
                            </li>
                            <li class="flex items-center gap-3 text-sm text-white font-medium">
                                <i data-lucide="message-circle" class="w-5 h-5 text-blue-400 shrink-0"></i>
                                <span>Direct WhatsApp/Line IDs</span>
                            </li>
                            <li class="flex items-center gap-3 text-sm text-white font-medium">
                                <i data-lucide="calendar-check" class="w-5 h-5 text-blue-400 shrink-0"></i>
                                <span>3-month access</span>
                            </li>
                        </ul>
                        <div class="mt-auto w-full pt-6">
                            <button onclick="openExclusiveInviteModal()"
                                class="w-full text-center py-3 rounded-lg bg-white text-black text-sm font-bold hover:bg-zinc-200 transition-colors shadow-[0_0_20px_rgba(255,255,255,0.1)]">
                                Join Waitlist ‚Äî Pay $0 Today
                            </button>
                            <p class="text-center text-[10px] text-zinc-500 mt-3 uppercase tracking-wider">$29
                                (One-Time) ‚Äî Regularly $49</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    </section>

    <!-- Footer -->
    <footer class="py-12 bg-black border-t border-zinc-800/50">
        <div class="max-w-7xl mx-auto px-6 flex flex-col md:flex-row items-center justify-between gap-6">
            <div class="flex items-center gap-2 group">
                <span class="text-xl font-bold tracking-tight text-white">Fightlore <span
                        class="text-blue-500">+</span><span
                        class="inline-flex items-center gap-1 px-1.5 py-[1px] rounded-full border border-white/10 bg-white/5 text-[9px] font-bold text-blue-400 ml-1.5 align-middle leading-none"><span
                            class="relative flex h-1 w-1"><span
                                class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span><span
                                class="relative inline-flex rounded-full h-1 w-1 bg-blue-500"></span></span>BETA</span></span>
            </div>
            <div class="text-zinc-500 text-sm">
                &copy; 2026 Fightlore +.All rights reserved.
            </div>
            <div class="flex gap-6 text-zinc-400">
                <a href="#" id="link-privacy" class="hover:text-white transition-colors">Privacy</a>
                <a href="#" id="link-terms" class="hover:text-white transition-colors">Terms</a>
            </div>
        </div>
    </footer>

    <!-- VIP Onboarding Modal -->
    <div id="vip-onboarding-modal"
        class="fixed inset-0 z-50 hidden items-center justify-center bg-black/95 backdrop-blur-sm p-4 animate-fade-in">
        <div class="bg-zinc-900 border border-zinc-800 rounded-xl w-full max-w-lg overflow-hidden relative shadow-2xl">
            <!-- Header -->
            <div class="p-6 border-b border-zinc-800 bg-zinc-950/50">
                <h3 class="text-2xl font-bold text-white mb-1">Payment Confirmed! üéâ</h3>
                <p class="text-zinc-400 text-sm">Let's get your training trip sorted.</p>
                <button id="close-vip-modal-btn"
                    class="absolute top-6 right-6 text-zinc-500 hover:text-white transition-colors">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Body -->
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <form id="vip-onboarding-form" class="space-y-6">
                    <!-- Gym Choice -->
                    <div class="space-y-2">
                        <label for="vip-gym-name" class="block text-sm font-medium text-zinc-300">
                            Which gym do you want to book?
                        </label>
                        <input type="text" id="vip-gym-name" required placeholder="e.g. Tiger Muay Thai, AKA..."
                            class="w-full bg-zinc-950 border border-zinc-700 rounded-lg px-4 py-3 text-white placeholder-zinc-600 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-colors">
                    </div>

                    <!-- Training Type -->
                    <div class="space-y-2">
                        <label for="vip-training-type" class="block text-sm font-medium text-zinc-300">
                            Training Focus
                        </label>
                        <select id="vip-training-type"
                            class="w-full bg-zinc-950 border border-zinc-700 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-colors appearance-none">
                            <option value="muay-thai">Muay Thai</option>
                            <option value="bjj">Brazilian Jiu-Jitsu (BJJ)</option>
                            <option value="mma">MMA</option>
                            <option value="fitness">Fitness / Conditioning</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <!-- Date -->
                    <div class="space-y-2">
                        <label for="vip-start-date" class="block text-sm font-medium text-zinc-300">
                            Preferred Start Date
                        </label>
                        <input type="date" id="vip-start-date" required
                            class="w-full bg-zinc-950 border border-zinc-700 rounded-lg px-4 py-3 text-white placeholder-zinc-600 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-colors [color-scheme:dark]">
                    </div>

                    <!-- Notes -->
                    <div class="space-y-2">
                        <label for="vip-notes" class="block text-sm font-medium text-zinc-300">
                            Additional Notes <span class="text-zinc-500 font-normal">(Optional)</span>
                        </label>
                        <textarea id="vip-notes" rows="3"
                            placeholder="Beginner? Need gear rental? Private session request?"
                            class="w-full bg-zinc-950 border border-zinc-700 rounded-lg px-4 py-3 text-white placeholder-zinc-600 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-colors resize-none"></textarea>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="p-6 border-t border-zinc-800 bg-zinc-950/50">
                <button type="submit" form="vip-onboarding-form"
                    class="w-full py-3.5 rounded-xl bg-emerald-600 hover:bg-emerald-500 text-white font-bold text-lg transition-all shadow-lg shadow-emerald-900/20">
                    Submit Request
                </button>
            </div>
        </div>
    </div>

    <!-- Video Modal (Full Screen - Simple) -->
    <div id="video-modal-full"
        class="fixed inset-0 z-50 hidden items-center justify-center bg-black/95 backdrop-blur-sm p-4 animate-fade-in">
        <button id="close-modal-full-btn"
            class="absolute top-6 right-6 text-white hover:text-gray-300 transition-colors z-50">
            <i data-lucide="x" class="w-10 h-10"></i>
        </button>
        <div
            class="w-full max-w-5xl aspect-video relative rounded-xl overflow-hidden shadow-2xl border border-zinc-800 bg-black">
            <video id="modal-video-full" class="w-full h-full object-cover" controls autoplay playsinline></video>
        </div>
    </div>

    <!-- Video Modal (Redesigned) -->
    <div id="video-modal"
        class="fixed inset-0 z-50 hidden items-center justify-center bg-black/95 backdrop-blur-sm p-4 animate-fade-in text-left">

        <!-- Modal Card -->
        <div
            class="relative bg-zinc-900 w-full max-w-3xl rounded-xl overflow-hidden shadow-2xl border border-zinc-800 flex flex-col h-[85vh]">

            <!-- Close Button (Global Overlay) -->
            <button id="close-modal-btn"
                class="absolute top-4 right-4 bg-black/50 hover:bg-black/70 p-2 rounded-full text-white backdrop-blur-md z-50 transition-colors">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>

            <!-- VIDEO COLUMN (Top) -->
            <div id="modal-video-column"
                class="w-full bg-black relative h-[60%] group transition-all duration-500 ease-in-out">
                <video id="modal-video" class="w-full h-full object-cover" controls autoplay playsinline></video>

                <!-- Unlock Overlay -->
                <div id="video-unlock-overlay"
                    class="absolute inset-0 bg-black/60 backdrop-blur-md flex flex-col items-center justify-center p-6 text-center opacity-0 pointer-events-none transition-all duration-500 z-30">
                    <div
                        class="bg-blue-600/10 w-16 h-16 rounded-full flex items-center justify-center mb-4 border border-blue-500/30">
                        <i data-lucide="lock" class="w-8 h-8 text-blue-500"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Watch the Full Verified Tour</h3>
                    <p class="text-zinc-400 text-sm mb-6 max-w-xs">Unlock 200+ full-length verified gym tours with the
                        Season Pass.</p>
                    <button onclick="openExclusiveInviteModal()"
                        class="px-8 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-lg font-bold text-sm transition-all shadow-lg shadow-blue-600/20">
                        Unlock Full Access
                    </button>
                    <button onclick="hideUnlockOverlay()"
                        class="mt-4 text-xs text-zinc-500 hover:text-white transition-colors">
                        Continue Preview
                    </button>
                </div>
            </div>

            <!-- INFO COLUMN (Bottom) -->
            <div id="modal-info-column"
                class="w-full bg-zinc-950 relative overflow-hidden flex flex-col h-[40%] border-t border-zinc-900 transition-all duration-500 ease-in-out">

                <!-- Slider Track (Simplified to single view) -->
                <div id="modal-info-slider"
                    class="w-full h-full flex transition-transform duration-500 ease-in-out translate-x-0">

                    <!-- VIEW 1: Summary (Default) -->
                    <div class="w-full h-full flex flex-col p-5 overflow-y-auto no-scrollbar">
                        <!-- Header -->
                        <div class="mb-3 mt-1 flex items-start justify-between">
                            <div>
                                <div class="flex items-center gap-2 mb-2">
                                    <h2 id="modal-title"
                                        class="text-2xl md:text-3xl font-serif italic text-white leading-tight">Gym Name
                                    </h2>
                                    <div
                                        class="flex items-center gap-1 text-yellow-500 text-sm font-bold bg-yellow-500/10 px-2 py-0.5 rounded-full border border-yellow-500/20">
                                        <i data-lucide="star" class="w-3.5 h-3.5 fill-current"></i>
                                        <span id="modal-rating">5.0</span>
                                    </div>
                                </div>
                                <span id="modal-location"
                                    class="text-zinc-500 text-sm font-medium uppercase tracking-wider flex items-center gap-1">
                                    <i data-lucide="map-pin" class="w-3 h-3"></i>
                                    <span>Location</span>
                                </span>
                            </div>
                            <div id="live-tracker"
                                class="flex items-center gap-2 bg-zinc-900/80 border border-zinc-800 rounded-full px-3 py-1.5 shadow-inner">
                                <span id="live-dot" class="relative flex h-2 w-2">
                                    <span
                                        class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                                    <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                                </span>
                                <span id="live-text"
                                    class="text-[10px] font-bold uppercase tracking-wider text-emerald-400">Live: Low
                                    Traffic</span>
                            </div>
                        </div>

                        <!-- Intro Text -->
                        <p id="modal-desc" class="text-xs text-zinc-400 leading-relaxed mb-4 line-clamp-2">
                            Experience authentic Muay Thai training in a world-class facility. Our certified
                            trainers
                            bring years of ring experience to help you achieve your fitness and fighting goals.
                        </p>

                        <!-- Ask AI Button -->
                        <button id="btn-ask-ai" onclick="askAiAboutGym()"
                            class="w-full py-2.5 bg-zinc-800 hover:bg-zinc-700 text-zinc-300 hover:text-white rounded-xl border border-zinc-700 transition-all flex items-center justify-center gap-2 mb-4 group">
                            <i data-lucide="message-square" class="w-4 h-4 text-blue-400 group-hover:text-blue-300"></i>
                            <span class="text-sm font-medium">Ask AI About This Gym</span>
                        </button>

                        <!-- Action Tabs -->
                        <div class="grid grid-cols-3 gap-2 mb-4">
                            <!-- Get Info (Free) -->
                            <button id="btn-get-info"
                                class="w-full py-2 bg-zinc-800/50 hover:bg-zinc-800 text-zinc-300 rounded-xl border border-zinc-800 hover:border-zinc-700 transition-all flex flex-col items-center justify-center gap-1 h-14 group">
                                <i data-lucide="clipboard-list"
                                    class="w-5 h-5 mb-0.5 group-hover:scale-110 transition-transform"></i>
                                <span class="text-[10px] font-medium uppercase tracking-wider">Get Info</span>
                            </button>

                            <!-- Map -->
                            <button id="btn-action-map"
                                class="w-full py-2 bg-zinc-800/50 hover:bg-zinc-800 text-zinc-300 rounded-xl border border-zinc-800 hover:border-zinc-700 transition-all flex flex-col items-center justify-center gap-1 h-14 group">
                                <i data-lucide="map"
                                    class="w-5 h-5 mb-0.5 group-hover:scale-110 transition-transform"></i>
                                <span class="text-[10px] font-medium uppercase tracking-wider">Map</span>
                            </button>

                            <!-- Book Assistant (Premium) -->
                            <button id="btn-concierge-book"
                                class="w-full py-2 bg-white hover:bg-zinc-200 text-black rounded-xl font-bold transition-all flex flex-col items-center justify-center gap-0.5 h-14 shadow-lg shadow-white/5 relative overflow-hidden group">
                                <div
                                    class="absolute inset-0 bg-gradient-to-tr from-zinc-200/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity">
                                </div>
                                <div class="flex items-center justify-center gap-1 relative z-10">
                                    <i data-lucide="handshake" class="w-4 h-4"></i>
                                    <span class="text-[10px] uppercase tracking-wider font-bold">Booking Service</span>
                                </div>
                                <span class="text-[9px] text-zinc-600 font-bold relative z-10">$15 Instant</span>
                            </button>
                        </div>


                    </div>


                </div>
            </div>
            <!-- Full Screen Details Overlay (Absolute, swipes over everything) -->
            <div id="full-screen-details"
                class="absolute inset-0 bg-zinc-950 z-40 translate-x-full transition-transform duration-500 ease-in-out flex flex-col overflow-hidden">

                <!-- HEADER & TABS STICKY -->
                <div class="shrink-0 bg-zinc-950 z-10 pt-6">
                    <!-- Back Button -->
                    <button id="btn-info-back"
                        class="flex items-center gap-2 text-zinc-400 hover:text-white transition-colors px-5 pb-4 group w-full">
                        <i data-lucide="arrow-left" class="w-5 h-5 group-hover:-translate-x-1 transition-transform"></i>
                        <span class="text-base font-medium">Back to Summary</span>
                    </button>

                    <!-- TAB NAVIGATION -->
                    <div class="flex items-center px-5 gap-8 mt-2 overflow-x-auto no-scrollbar">
                        <button onclick="switchTab('overview')" id="tab-btn-overview"
                            class="pb-4 text-xs md:text-sm font-bold uppercase tracking-widest text-white border-b-2 border-white transition-colors whitespace-nowrap">Overview</button>
                        <button onclick="switchTab('training')" id="tab-btn-training"
                            class="pb-3 text-xs md:text-sm font-bold tracking-wider text-zinc-500 border-b-2 border-transparent transition-all hover:text-white">
                            TRAINING
                        </button>
                        <button onclick="switchTab('photos')" id="tab-btn-photos"
                            class="pb-3 text-xs md:text-sm font-bold tracking-wider text-zinc-500 border-b-2 border-transparent transition-all hover:text-white">
                            PHOTOS
                        </button>
                        <button disabled
                            class="pb-4 text-xs md:text-sm font-bold uppercase tracking-widest text-zinc-700 cursor-not-allowed border-b-2 border-transparent flex items-center gap-1.5 whitespace-nowrap">
                            Reviews <i data-lucide="lock" class="w-3 h-3"></i>
                        </button>
                    </div>
                </div>

                <!-- CONTENT AREA (Scrollable) -->
                <div id="modal-detailed-content" class="flex-1 overflow-y-auto no-scrollbar pb-0">

                    <!-- TAB 1: OVERVIEW -->
                    <div id="tab-content-overview" class="space-y-8 animate-fade-in-up p-5">
                        <div class="space-y-4">
                            <div class="flex justify-between items-start">
                                <h3 class="text-3xl font-serif italic text-white" id="detail-title">About the Gym</h3>
                                <div id="detail-recommended"
                                    class="hidden px-3 py-1 bg-yellow-500/20 text-yellow-400 border border-yellow-500/30 rounded-full text-xs font-bold uppercase tracking-wider">
                                    <i data-lucide="star" class="w-3 h-3 inline mr-1"></i> Recommended
                                </div>
                            </div>

                            <!-- Vibe Tags Container -->
                            <div id="detail-tags" class="flex flex-wrap gap-2"></div>

                            <!-- New: Quick Stats Grid -->
                            <div class="grid grid-cols-2 gap-4 py-4 border-y border-zinc-900">
                                <div>
                                    <span
                                        class="text-[10px] text-zinc-500 uppercase tracking-wider font-bold mb-1 flex items-center gap-1.5">
                                        <i data-lucide="mail" class="w-3 h-3 text-yellow-500"></i> Email
                                    </span>
                                    <span id="detail-email-display" class="text-zinc-200 text-sm font-medium">--</span>
                                </div>
                                <div>
                                    <span
                                        class="text-[10px] text-zinc-500 uppercase tracking-wider font-bold mb-1 flex items-center gap-1.5">
                                        <i data-lucide="clock" class="w-3 h-3 text-blue-500"></i> Open
                                    </span>
                                    <span id="detail-open" class="text-zinc-200 text-sm font-medium">--</span>
                                </div>
                                <div>
                                    <span
                                        class="text-[10px] text-zinc-500 uppercase tracking-wider font-bold mb-1 flex items-center gap-1.5">
                                        <i data-lucide="languages" class="w-3 h-3 text-emerald-500"></i> Language
                                    </span>
                                    <span id="detail-language" class="text-zinc-200 text-sm font-medium">--</span>
                                </div>
                                <div>
                                    <span
                                        class="text-[10px] text-zinc-500 uppercase tracking-wider font-bold mb-1 flex items-center gap-1.5">
                                        <i data-lucide="map-pin" class="w-3 h-3 text-rose-500"></i> Location
                                    </span>
                                    <span id="detail-address-short"
                                        class="text-zinc-200 text-sm font-medium truncate">--</span>
                                </div>
                                <div>
                                    <span
                                        class="text-[10px] text-zinc-500 uppercase tracking-wider font-bold mb-1 flex items-center gap-1.5">
                                        <i data-lucide="phone" class="w-3 h-3 text-purple-500"></i> Phone
                                    </span>
                                    <span id="detail-phone" class="text-zinc-200 text-sm font-medium block">--</span>
                                </div>
                                <div>
                                    <span
                                        class="text-[10px] text-zinc-500 uppercase tracking-wider font-bold mb-1 flex items-center gap-1.5">
                                        <i data-lucide="map" class="w-3 h-3 text-orange-500"></i> Address
                                    </span>
                                    <span id="detail-address-full"
                                        class="text-zinc-200 text-sm font-medium block leading-snug">--</span>
                                </div>
                            </div>
                        </div>

                        <p class="text-zinc-400 text-base leading-relaxed" id="detail-desc">
                            <!-- Dynamic Description -->
                        </p>
                    </div>
                </div>

                <!-- TAB 2: TRAINING (Logistics) - Clean List Design -->
                <div id="tab-content-training"
                    class="flex flex-col gap-4 hidden animate-fade-in-up px-5 pb-10 pt-0 -mt-2">



                    <!-- Nearby Amenities -->
                    <div class="border-b border-zinc-800/50 pb-4 last:border-0 last:pb-0">
                        <h5
                            class="text-zinc-500 text-[10px] font-bold uppercase tracking-wider mb-1.5 flex items-center gap-2">
                            <i data-lucide="map-pin" class="w-3 h-3 text-emerald-500"></i> Nearby Amenities
                        </h5>
                        <div id="detail-logistics-amenities" class="flex flex-wrap gap-2">--</div>
                    </div>

                    <!-- Class Duration -->
                    <div class="border-b border-zinc-800/50 pb-4 last:border-0 last:pb-0">
                        <h5
                            class="text-zinc-500 text-[10px] font-bold uppercase tracking-wider mb-1.5 flex items-center gap-2">
                            <i data-lucide="clock" class="w-3 h-3 text-blue-500"></i> Class Duration
                        </h5>
                        <p id="detail-logistics-duration" class="text-zinc-200 text-sm pt-1.5">--</p>
                    </div>

                    <!-- Prices -->
                    <div class="border-b border-zinc-800/50 pb-4 last:border-0 last:pb-0">
                        <h5
                            class="text-zinc-500 text-[10px] font-bold uppercase tracking-wider mb-1.5 flex items-center gap-2">
                            <i data-lucide="tag" class="w-3 h-3 text-yellow-500"></i> Prices
                        </h5>
                        <div id="detail-logistics-price" class="flex flex-wrap gap-2">--</div>
                    </div>

                    <!-- Accommodation -->
                    <div class="border-b border-zinc-800/50 pb-4 last:border-0 last:pb-0">
                        <h5
                            class="text-zinc-500 text-[10px] font-bold uppercase tracking-wider mb-1.5 flex items-center gap-2">
                            <i data-lucide="bed" class="w-3 h-3 text-purple-500"></i> Accommodation
                        </h5>
                        <p id="detail-logistics-accom" class="text-zinc-200 text-sm leading-relaxed pt-1.5">--</p>
                    </div>



                    <!-- Contact & Location (Moved here) -->
                    <div class="mt-6">
                        <div class="grid grid-cols-2 gap-3">
                            <a id="btn-link-insta" href="#" target="_blank"
                                class="p-3 bg-zinc-900 hover:bg-zinc-800 rounded-xl flex items-center justify-center gap-2 text-zinc-300 transition-colors">
                                <i data-lucide="instagram" class="w-4 h-4"></i> Instagram
                            </a>
                            <a id="btn-link-facebook" href="#" target="_blank"
                                class="p-3 bg-zinc-900 hover:bg-zinc-800 rounded-xl flex items-center justify-center gap-2 text-zinc-300 transition-colors">
                                <i data-lucide="facebook" class="w-4 h-4"></i> Messenger
                            </a>
                            <div id="detail-contact-phone"
                                class="hidden p-3 bg-zinc-900/50 rounded-xl flex items-center justify-center gap-2 text-zinc-500 text-xs text-center border border-zinc-800 col-span-1">
                                <i data-lucide="phone" class="w-3 h-3"></i> <span id="val-phone">--</span>
                            </div>
                            <div id="detail-contact-email"
                                class="hidden p-3 bg-zinc-900/50 rounded-xl flex items-center justify-center gap-2 text-zinc-500 text-xs text-center border border-zinc-800 col-span-1">
                                <i data-lucide="mail" class="w-3 h-3"></i> <span id="val-email">--</span>
                            </div>
                        </div>

                    </div>
                </div>

                <!-- TAB 4: PHOTOS -->
                <div id="tab-content-photos" class="space-y-4 hidden animate-fade-in-up p-0">
                    <div id="detail-photos-grid" class="grid grid-cols-3 gap-0.5 overflow-hidden">
                        <!-- Dynamic Photos -->
                    </div>
                </div>

            </div>
        </div>
    </div>
    </div>
    <!-- End Video Modal Wrapper -->

    <!-- LIGHTBOX MODAL (Photos) -->
    <div id="lightbox-modal"
        class="fixed inset-0 z-[150] hidden items-center justify-center bg-black/95 backdrop-blur-xl p-4 animate-fade-in"
        onclick="if(event.target === this) { this.classList.add('hidden'); this.classList.remove('flex'); }">
        <button
            onclick="document.getElementById('lightbox-modal').classList.add('hidden'); document.getElementById('lightbox-modal').classList.remove('flex');"
            class="absolute top-6 right-6 text-white/50 hover:text-white transition-colors z-[160] p-2 bg-black/20 rounded-full">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>
        <img id="lightbox-image" src="" class="max-w-full max-h-[90vh] object-contain rounded shadow-2xl" />
    </div>
    <div id="text-modal"
        class="fixed inset-0 z-[120] hidden items-center justify-center bg-black/95 backdrop-blur-sm p-4">
        <button id="close-text-modal-btn"
            class="absolute top-6 right-6 text-white hover:text-gray-300 transition-colors z-50">
            <i data-lucide="x" class="w-10 h-10"></i>
        </button>
        <div
            class="bg-zinc-950 w-full max-w-3xl max-h-[80vh] rounded-xl border border-zinc-800 p-8 md:p-12 overflow-y-auto relative shadow-2xl">
            <h2 id="text-modal-title" class="text-3xl font-serif italic mb-6 text-white"></h2>
            <div id="text-modal-content" class="prose prose-invert prose-zinc max-w-none text-zinc-400 space-y-4">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification"
        class="fixed bottom-6 left-1/2 -translate-x-1/2 z-[100] hidden items-center gap-3 bg-zinc-900 text-white px-4 py-3 rounded-xl border border-zinc-800 shadow-2xl transition-all duration-300 transform translate-y-10 opacity-0">
        <i data-lucide="check-circle" class="w-5 h-5 text-emerald-500"></i>
        <span id="toast-message" class="text-sm font-medium">Notification</span>
    </div>



    <!-- Scripts -->
    <script>
        lucide.createIcons();

        // Global data store
        window.gymData = [];

        // Lightbox Logic
        window.openLightbox = (url) => {
            const lb = document.getElementById('lightbox-modal');
            const img = document.getElementById('lightbox-image');
            if (lb && img) {
                img.src = url;
                lb.classList.remove('hidden');
                lb.classList.add('flex');
            }
        };

        // Tab Switcher Logic
        window.switchTab = (tabId) => {
            // 1. Reset Buttons
            ['overview', 'training', 'photos'].forEach(t => {
                const btn = document.getElementById(`tab-btn-${t}`);
                const content = document.getElementById(`tab-content-${t}`);
                if (btn && content) {
                    if (t === tabId) {
                        btn.classList.add('text-white', 'border-white');
                        btn.classList.remove('text-zinc-500', 'border-transparent');
                        content.classList.remove('hidden');
                    } else {
                        btn.classList.remove('text-white', 'border-white');
                        btn.classList.add('text-zinc-500', 'border-transparent');
                        content.classList.add('hidden');
                    }
                }
            });
        };

        // Load Gym Data and Generate Cards Dynamically
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const res = await fetch('/api/gyms');
                const data = await res.json();
                window.gymData = data.gyms || [];
                console.log("‚úÖ Gym Data Loaded:", window.gymData.length);

                // Generate Cards Dynamically
                const swiperWrapper = document.querySelector('.swiper-wrapper');
                if (swiperWrapper && window.gymData.length > 0) {
                    // COMPLETELY CLEAR all existing cards
                    swiperWrapper.innerHTML = '';
                    console.log("üóëÔ∏è Cleared all existing cards");

                    // Generate cards from API data (triple for smooth infinite scroll)
                    for (let i = 0; i < 3; i++) {
                        window.gymData.forEach(gym => {
                            const card = document.createElement('div');
                            card.className = 'swiper-slide !w-[300px] md:!w-[400px] h-auto gym-card group cursor-pointer';

                            // Get training styles as array - use correct Airtable field name
                            const trainingStyles = gym['Training Styles Offered'] || gym['Training Styles'] || [];

                            let stylesArray = [];

                            if (Array.isArray(trainingStyles)) {
                                stylesArray = trainingStyles;
                            } else if (typeof trainingStyles === 'string') {
                                // If it's a comma-separated string, split it
                                stylesArray = trainingStyles.split(',').map(s => s.trim()).filter(s => s);
                            }

                            // Fallback to default if empty
                            if (stylesArray.length === 0) {
                                stylesArray = ['Muay Thai'];
                            }

                            // Color mapping for different styles
                            const getStyleColor = (style) => {
                                const styleLower = style.toLowerCase();
                                if (styleLower.includes('muay thai')) return 'bg-sky-500/10 border-sky-500/20 text-sky-400';
                                if (styleLower.includes('mma')) return 'bg-blue-500/10 border-blue-500/20 text-blue-400';
                                if (styleLower.includes('boxing')) return 'bg-indigo-500/10 border-indigo-500/20 text-indigo-400';
                                if (styleLower.includes('fitness')) return 'bg-cyan-500/10 border-cyan-500/20 text-cyan-400';
                                return 'bg-zinc-800/50 border-zinc-700/50 text-zinc-300';
                            };

                            // Image support - Airtable field name is 'Primary Photo'
                            let imageUrl = '';
                            const imageField = gym['Primary Photo'] || gym['Primary Image'] || gym['Primary Image URL'] || gym['Image'];
                            if (imageField) {
                                // If it's an array (Airtable attachment), extract URL from first item
                                if (Array.isArray(imageField) && imageField.length > 0) {
                                    imageUrl = imageField[0].url || imageField[0].thumbnails?.large?.url || '';
                                } else if (typeof imageField === 'object' && imageField.url) {
                                    imageUrl = imageField.url;
                                } else if (typeof imageField === 'string') {
                                    imageUrl = imageField;
                                }
                            }
                            // Fallback image
                            if (!imageUrl) {
                                imageUrl = 'https://cdn.shopify.com/s/files/1/0564/3957/0639/files/Frame_1000004929_ed3172d4-2474-4c70-a87e-16e9bb91f90a.jpg?v=1768677712';
                            }

                            // Video support - use correct Airtable field name
                            const videoUrl = gym['Primary Video'] || gym['Primary Video URL'] || '';
                            let videoElement = '';
                            if (videoUrl) {
                                // Use regular video element (works for both direct videos and can use YouTube embed URLs)
                                videoElement = `<video loop muted playsinline class="absolute inset-0 w-full h-full object-cover z-10 opacity-0 transition-opacity duration-300 pointer-events-none" src="${videoUrl}"></video>`;
                            }

                            card.innerHTML = `
                                <div class="bg-zinc-900/50 backdrop-blur-sm rounded-xl overflow-hidden border border-zinc-800 hover:border-zinc-500/50 transition-all duration-300 h-full flex flex-col hover:shadow-2xl hover:shadow-black/50">
                                    <div class="aspect-[4/3] bg-zinc-800 relative overflow-hidden shrink-0">
                                        <img src="${imageUrl}" 
                                             class="w-full h-full object-cover relative z-10" alt="${gym.name}">
                                        ${videoElement}
                                        <div class="absolute inset-0 bg-gradient-to-t from-zinc-900/80 via-transparent to-transparent z-10 pointer-events-none"></div>
                                        <div class="absolute top-4 right-4 bg-black/40 backdrop-blur-md border border-white/10 px-3 py-1.5 rounded-full text-xs font-medium text-white z-20 flex items-center gap-1.5 shadow-lg">
                                            <i data-lucide="map-pin" class="w-3 h-3 text-emerald-400"></i> ${gym.location || 'Thailand'}
                                        </div>
                                    </div>
                                    <div class="p-5 flex-1 flex flex-col gap-4">
                                        <div class="flex justify-between items-start gap-4">
                                            <h3 class="text-xl font-bold text-white leading-tight">${gym.name}</h3>
                                            <div class="flex items-center gap-1.5 px-2 py-1 bg-yellow-500/10 border border-yellow-500/20 rounded-lg text-yellow-400 text-xs font-bold">
                                                <i data-lucide="star" class="w-3.5 h-3.5 fill-current"></i> ${gym.rating || 4.8}
                                            </div>
                                        </div>
                                        <p class="text-zinc-400 text-sm leading-relaxed line-clamp-2">${gym['Summary'] || gym.description || 'Authentic Muay Thai training experience in Thailand.'}</p>
                                        <div class="mt-auto flex flex-wrap gap-2">
                                            ${stylesArray.slice(0, 3).map(style => `
                                                <span class="px-2.5 py-1 rounded-lg ${getStyleColor(style)} border text-xs font-medium transition-colors">
                                                    ${style}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `;
                            swiperWrapper.appendChild(card);
                        });
                    }

                    // Generate cards from API data (triple for smooth infinite scroll)
                    for (let i = 0; i < 3; i++) {
                        window.gymData.forEach(gym => {
                            const card = document.createElement('div');
                            card.className = 'swiper-slide !w-[300px] md:!w-[400px] h-auto gym-card group cursor-pointer';

                            // Get training styles as array - use correct Airtable field name
                            const trainingStyles = gym['Training Styles Offered'] || gym['Training Styles'] || [];
                            let stylesArray = [];

                            if (Array.isArray(trainingStyles)) {
                                stylesArray = trainingStyles;
                            } else if (typeof trainingStyles === 'string') {
                                // If it's a comma-separated string, split it
                                stylesArray = trainingStyles.split(',').map(s => s.trim()).filter(s => s);
                            }

                            // Fallback to default if empty
                            if (stylesArray.length === 0) {
                                stylesArray = ['Muay Thai'];
                            }

                            // Color mapping for different styles
                            const getStyleColor = (style) => {
                                const styleLower = style.toLowerCase();
                                if (styleLower.includes('muay thai')) return 'bg-sky-500/10 border-sky-500/20 text-sky-400';
                                if (styleLower.includes('mma')) return 'bg-blue-500/10 border-blue-500/20 text-blue-400';
                                if (styleLower.includes('boxing')) return 'bg-indigo-500/10 border-indigo-500/20 text-indigo-400';
                                if (styleLower.includes('fitness')) return 'bg-cyan-500/10 border-cyan-500/20 text-cyan-400';
                                return 'bg-zinc-800/50 border-zinc-700/50 text-zinc-300';
                            };

                            // Image support - Airtable field name is 'Primary Photo'
                            let imageUrl = '';
                            const imageField = gym['Primary Photo'] || gym['Primary Image'] || gym['Primary Image URL'] || gym['Image'];
                            if (imageField) {
                                // If it's an array (Airtable attachment), extract URL from first item
                                if (Array.isArray(imageField) && imageField.length > 0) {
                                    imageUrl = imageField[0].url || imageField[0].thumbnails?.large?.url || '';
                                } else if (typeof imageField === 'object' && imageField.url) {
                                    imageUrl = imageField.url;
                                } else if (typeof imageField === 'string') {
                                    imageUrl = imageField;
                                }
                            }
                            // Fallback image
                            if (!imageUrl) {
                                imageUrl = 'https://cdn.shopify.com/s/files/1/0564/3957/0639/files/Frame_1000004929_ed3172d4-2474-4c70-a87e-16e9bb91f90a.jpg?v=1768677712';
                            }

                            // Video support
                            const videoUrl = gym['Primary Video'] || gym['Primary Video URL'] || '';

                            card.innerHTML = `
                                <div class="bg-zinc-900/50 backdrop-blur-sm rounded-xl overflow-hidden border border-zinc-800 hover:border-zinc-500/50 transition-all duration-300 h-full flex flex-col hover:shadow-2xl hover:shadow-black/50">
                                    <div class="aspect-[4/3] bg-zinc-800 relative overflow-hidden shrink-0">
                                        <img src="${imageUrl}" 
                                             class="w-full h-full object-cover relative z-10" alt="${gym.name}">
                                        <video loop muted playsinline class="absolute inset-0 w-full h-full object-cover z-10 opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none" 
                                               src="${videoUrl}"></video>
                                        <div class="absolute inset-0 bg-gradient-to-t from-zinc-900/80 via-transparent to-transparent z-10 pointer-events-none"></div>
                                        <div class="absolute top-4 right-4 bg-black/40 backdrop-blur-md border border-white/10 px-3 py-1.5 rounded-full text-xs font-medium text-white z-20 flex items-center gap-1.5 shadow-lg">
                                            <i data-lucide="map-pin" class="w-3 h-3 text-emerald-400"></i> ${gym.location || 'Thailand'}
                                        </div>
                                    </div>
                                    <div class="p-5 flex-1 flex flex-col gap-4">
                                        <div class="flex justify-between items-start gap-4">
                                            <h3 class="text-xl font-bold text-white leading-tight">${gym.name}</h3>
                                            <div class="flex items-center gap-1.5 px-2 py-1 bg-yellow-500/10 border border-yellow-500/20 rounded-lg text-yellow-400 text-xs font-bold">
                                                <i data-lucide="star" class="w-3.5 h-3.5 fill-current"></i> ${gym.rating || 4.8}
                                            </div>
                                        </div>
                                        <p class="text-zinc-400 text-sm leading-relaxed line-clamp-2">${gym['Summary'] || gym.description || 'Authentic Muay Thai training experience in Thailand.'}</p>
                                        <div class="mt-auto flex flex-wrap gap-2">
                                            ${stylesArray.slice(0, 3).map(style => `
                                                <span class="px-2.5 py-1 rounded-lg ${getStyleColor(style)} border text-xs font-medium transition-colors">
                                                    ${style}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                            `;
                            swiperWrapper.appendChild(card);
                        });
                    }

                    // Hide loading indicator after minimum display time
                    const loadingIndicator = document.getElementById('gym-loading');
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                    }

                    // Reinitialize Lucide icons
                    lucide.createIcons();

                    // Destroy and reinitialize Swiper
                    if (window.mySwiper) window.mySwiper.destroy(true, true);
                    window.mySwiper = new Swiper('.mySwiper', {
                        slidesPerView: 'auto',
                        spaceBetween: 24,
                        loop: true,
                        loopedSlides: 8,
                        speed: 6000,
                        autoplay: {
                            delay: 0,
                            disableOnInteraction: false,
                            pauseOnMouseEnter: true
                        },
                        freeMode: true,
                        freeModeMomentum: false,
                        grabCursor: true,
                        allowTouchMove: true
                    });

                    console.log("‚úÖ Dynamic Cards Generated & Swiper Reinitialized");
                }
            } catch (err) {
                console.error("Failed to load gym data:", err);
            }
        });

        // Mobile Menu Logic
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const closeMenuBtn = document.getElementById('close-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');

        function toggleMobileMenu() {
            mobileMenu.classList.toggle('hidden');
            mobileMenu.classList.toggle('flex');
            document.body.classList.toggle('overflow-hidden');
        }

        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        closeMenuBtn.addEventListener('click', toggleMobileMenu);

        // Live Crowd Tracker Logic
        async function updateLiveTracker() {
            try {
                const response = await fetch('/api/gym-status');
                const data = await response.json();

                const tracker = document.getElementById('live-tracker');
                const textEl = document.getElementById('live-text');
                if (!tracker || !textEl) return;

                const dotEl = tracker.querySelector('span.relative.inline-flex');
                const pingEl = tracker.querySelector('span.animate-ping');

                // Determine classes based on color
                let colorClass = "emerald-400";
                let dotClass = "bg-emerald-500";
                let pingClass = "bg-emerald-400";

                if (data.color === 'yellow') {
                    colorClass = "yellow-400";
                    dotClass = "bg-yellow-500";
                    pingClass = "bg-yellow-400";
                } else if (data.color === 'red') {
                    colorClass = "red-400";
                    dotClass = "bg-red-500";
                    pingClass = "bg-red-400";
                } else if (data.color === 'zinc') {
                    colorClass = "zinc-500";
                    dotClass = "bg-zinc-600";
                    pingClass = "bg-zinc-500 opacity-0"; // No ping for closed
                }

                textEl.textContent = data.status;
                textEl.className = `text-[10px] font-bold uppercase tracking-wider text-${colorClass}`;
                if (dotEl) dotEl.className = `relative inline-flex rounded-full h-2 w-2 ${dotClass}`;
                if (pingEl) pingEl.className = `${data.color === 'zinc' ? '' : 'animate-ping'} absolute inline-flex h-full w-full rounded-full ${pingClass} opacity-75`;

            } catch (err) {
                console.warn("Could not fetch live status:", err);
            }
        }

        // Hook into the click event for gym cards to trigger the update
        // We can do this by observing when the modal opens or just exposing it
        // Since we are using event delegation for the swiper above, we can call it there.
        // But to be safe and simple, let's just run it every few seconds to simulate "live" updates if the modal is open
        setInterval(() => {
            const videoModal = document.getElementById('video-modal');
            if (videoModal && !videoModal.classList.contains('hidden')) {
                // 10% chance to change status while open to feel "alive"
                if (Math.random() > 0.9) updateLiveTracker();
            }
        }, 3000);

        // Also expose it globally so the click handler can call it for an initial state
        window.refreshLiveTracker = updateLiveTracker;

        // --- Chatbot Logic ---
        // --- Chatbot Logic (Fightlore Scout Persona) ---
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatHistory = document.getElementById('chat-history');
        const suggestionPills = document.getElementById('suggestion-pills');

        // Conversation history for context (keep last 5 messages)
        let conversationHistory = [];

        // System Prompt (For reference/future API use)
        const SYSTEM_PROMPT = `
        Role: You are the Fightlore Scout, a Thailand Muay Thai expert currently on the ground visiting gyms. Your goal is to help users find the perfect training spot using the Fightlore Verified Database.
        Tone: Expert, helpful, and direct. Use Thai greetings like "Sawadee Krap" and "Kop Khun Krap" naturally.
        Core Knowledge (The 5 Verified Gyms): You ONLY have deep-dive data for these 5 gyms. Do not invent details for others.
        1. Kiatsongkrit Gym (Bangkok): Premium equipment, sauna, personal training, AC.
        2. Pinsinchai Muay Thai Gym (Bangkok): Traditional, world-class camp, authentic vibes.
        3. Kiatphontip Muay Thai (Chiang Mai): Community-driven, great for drop-ins, offers CrossFit.
        4. PK. Saenchai Muay Thai Gym (Koh Samui): Incredible views, expert instructors, famous name.
        5. Tiger Muay Thai (Phuket): [Placeholder] Large, commercial, all-in-one resort.
        Operational Rules:
        - Strict Verification: If a user asks for a gym NOT in the list above, explain: "I haven't personally stepped into that gym yet‚ÄîI only recommend spots I have hand-verified to ensure the pricing and quality are real."
        - The Pivot: After explaining why you can't recommend a specific unverified gym, pivot back to the 5 you have.
        - The Feature Match: If a user asks for a feature (e.g., "Sauna" or "CrossFit"), point them directly to the specific match.
        - The "Phase 2" Call to Action: Always end interactions with unverified requests by saying: "I am adding 5 new gyms every week. Click the 'Unlock 100+ More' button below to join the waitlist and vote for which city I should scout next!"
        `;

        // Simulated Database (Black Book)
        const gymDatabase = {
            kiatsongkrit: {
                name: "Kiatsongkrit Gym",
                location: "Bangkok",
                vibe: "Premium & Modern",
                crowd: "Serious & VIPs",
                price: "$50 Drop-in",
                features: ["sauna", "ac", "personal training", "clean"],
                note: "Top-tier facilities with AC and Sauna. Perfect if you want comfort with your violence."
            },
            pinsinchai: {
                name: "Pinsinchai Muay Thai",
                location: "Bangkok",
                vibe: "Authentic & Hard",
                crowd: "Fighters",
                price: "400 THB Drop-in",
                features: ["authentic", "traditional", "clinch"],
                note: "Old school vibes. This is where you go to learn real fight IQ."
            },
            kiatphontip: {
                name: "Kiatphontip Gym",
                location: "Chiang Mai",
                vibe: "Community & Technical",
                crowd: "Mixed & Friendly",
                price: "300 THB Drop-in",
                features: ["crossfit", "community", "technical"],
                note: "Great mix of Muay Thai and strength work. Super welcoming community."
            },
            pksaenchai: {
                name: "PK. Saenchai Gym",
                location: "Koh Samui",
                vibe: "Views & Elite",
                crowd: "Tourists & Pros",
                price: "500 THB Drop-in",
                features: ["views", "scenery", "island", "famous"],
                note: "Training with a view. World famous name, island life."
            }
        };

        // State Machine
        let chatState = {
            step: 0,
            userIntent: '',
            location: ''
        };

        // Auto-Greeting
        // Auto-Greeting removed

        // Handle suggestion clicks
        const pills = document.querySelectorAll('#suggestion-pills button');
        pills.forEach(pill => {
            pill.addEventListener('click', () => {
                const text = pill.innerText.trim();
                chatInput.value = text; // Just put exact text
                chatForm.dispatchEvent(new Event('submit'));
            });
        });

        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            // CHECK LIMIT BEFORE SENDING
            if (checkChatLimit()) return;

            const message = chatInput.value.trim();
            if (!message) return;

            addMessage(message, 'user');
            chatInput.value = '';

            // Increment Count
            messageCount++;
            console.log("Message Count:", messageCount);

            if (suggestionPills) suggestionPills.style.display = 'none';

            // Check limit again immediately to update UI if needed (e.g. at 7)
            if (checkChatLimit()) return;

            const loadingId = addLoadingIndicator();

            try {
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message,
                        conversationHistory: conversationHistory.slice(-5) // Send last 5 messages
                    })
                });

                const data = await response.json();
                removeMessage(loadingId);

                if (data.error) {
                    addMessage("I'm having trouble reaching headquarters. Please try again.", 'ai');
                } else if (data.useMock) {
                    addMessage("‚ö†Ô∏è Backend is disconnected. " + data.message, 'ai');
                } else {
                    const aiResponse = data.response;
                    addMessage(aiResponse, 'ai');

                    // Add to conversation history
                    conversationHistory.push({ role: 'user', content: message });
                    conversationHistory.push({ role: 'assistant', content: aiResponse });
                }
            } catch (err) {
                removeMessage(loadingId);
                addMessage("Connection error. Is the server running?", 'ai');
                console.error(err);
            }

            chatHistory.scrollTop = chatHistory.scrollHeight;
        });



        function addMessage(text, sender) {
            const div = document.createElement('div');
            // Gemini Style: No bubbles for AI, just icon + text. User gets a bubble.
            // Wide container, left aligned for AI. Right aligned bubble for user.

            if (sender === 'ai') {
                // Parse for Pills: |||Gym Name|||
                let displayCode = text;
                const matches = text.match(/\|\|\|(.*?)\|\|\|/g);
                let pillsHtml = '';

                if (matches) {
                    displayCode = text.replace(/\|\|\|(.*?)\|\|\|/g, '<b>$1</b>'); // Bold instead of stripping
                    pillsHtml = `<div class="mt-3 flex flex-wrap gap-2">`;
                    matches.forEach(match => {
                        const gymName = match.replace(/\|\|\|/g, '');
                        pillsHtml += `<button onclick="openVideoModalByName('${gymName}')" class="px-4 py-2 bg-blue-600/20 hover:bg-blue-600/40 text-blue-300 text-sm rounded-full border border-blue-500/30 transition-all flex items-center gap-2 group">
                            <span>${gymName}</span>
                            <i data-lucide="arrow-right" class="w-3 h-3 group-hover:translate-x-1 transition-transform"></i>
                        </button>`;
                    });
                    pillsHtml += `</div>`;
                }

                div.className = `flex gap-4 animate-fade-in w-full max-w-3xl`;
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-400 to-blue-600 flex items-center justify-center text-white shrink-0 mt-1 shadow-lg shadow-blue-500/20">
                        <i data-lucide="sparkles" class="w-4 h-4"></i>
                    </div>
                    <div class="space-y-2 flex-1">
                        <div class="text-zinc-200 text-[15px] leading-relaxed font-light tracking-wide">
                            ${displayCode}
                        </div>
                        ${pillsHtml}
                    </div>
                `;
            } else {
                div.className = `flex gap-4 animate-fade-in flex-row-reverse w-full ml-auto max-w-3xl`;
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-zinc-800 flex items-center justify-center text-white shrink-0 mt-1 border border-zinc-700">
                        <i data-lucide="user" class="w-4 h-4"></i>
                    </div>
                    <div class="bg-[#1e1e1e] text-zinc-100 px-5 py-3 rounded-xl rounded-tr-sm border border-zinc-800 shadow-sm">
                        <p class="text-[15px]">${text}</p>
                    </div>
                `;
            }
            chatHistory.appendChild(div);
            // Re-init icons for new content
            lucide.createIcons();
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // --- Chat Limit Logic ---
        let messageCount = 0;
        const FREE_CHAT_LIMIT = 7;
        const chatInputContainer = document.getElementById('chat-input-container'); // Need to ID this div in HTML logic below if not exists

        function checkChatLimit() {
            if (messageCount >= FREE_CHAT_LIMIT) {
                showWaitlistCard();
                return true;
            }
            return false;
        }

        function showWaitlistCard() {
            console.log("Triggering Founding Waitlist Modal...");

            // Hide input container
            const inputForm = document.getElementById('chat-input-container');
            if (inputForm) inputForm.style.display = 'none';

            // Hide suggestion pills
            const pills = document.getElementById('suggestion-pills');
            if (pills) pills.style.display = 'none';

            // Show limit prompt card
            const limitPrompt = document.getElementById('chat-limit-prompt');
            if (limitPrompt) {
                limitPrompt.classList.remove('hidden');
                // Re-init icons for the new card
                if (window.lucide) lucide.createIcons();
            }

            // Show New Founding Modal
            if (window.openExclusiveInviteModal) {
                window.openExclusiveInviteModal();
            } else {
                console.error("openExclusiveInviteModal not defined");
            }

            // Also scroll to bottom
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function addLoadingIndicator() {
            const id = 'loading-' + Date.now();
            const div = document.createElement('div');
            div.id = id;
            div.className = 'flex gap-4 animate-fade-in w-full max-w-3xl';
            div.innerHTML = `
                <div class="w-8 h-8 rounded-full bg-gradient-to-tr from-blue-400 to-blue-600 flex items-center justify-center text-white shrink-0 mt-1 shadow-lg shadow-blue-500/20">
                    <i data-lucide="sparkles" class="w-4 h-4"></i>
                </div>
                <div class="space-y-2 flex-1">
                     <div class="flex gap-1 bg-zinc-900/50 px-4 py-3 rounded-2xl w-fit items-center">
                        <span class="w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 0ms"></span>
                        <span class="w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 150ms"></span>
                        <span class="w-1.5 h-1.5 bg-blue-400 rounded-full animate-bounce" style="animation-delay: 300ms"></span>
                    </div>
                </div>
            `;
            chatHistory.appendChild(div);
            lucide.createIcons();
            chatHistory.scrollTop = chatHistory.scrollHeight;
            return id;
        }

        function removeMessage(id) {
            const el = document.getElementById(id);
            if (el) el.remove();
        }

        // --- Video Modal Logic ---
        // REMOVED: Conflicted with Swiper delegation and Redesigned Modal Logic below.
        // All modal interactions are now handled by the Swiper wrapper delegation and the unified logic block.

        // --- Stripe Payment Client-Side Logic ---
        // --- Stripe Payment Client-Side Logic ---
        async function handleCheckout(priceType) {
            try {
                let btnId;
                if (priceType === 'fighter-passport') btnId = 'btn-fighter-passport';
                else if (priceType === 'vip-concierge') btnId = 'btn-vip-concierge';
                else return;

                const button = document.getElementById(btnId);
                const originalText = button.innerText;
                button.innerText = 'Processing...';
                button.disabled = true;

                const response = await fetch('http://localhost:3000/api/create-checkout-session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ priceType }),
                });

                const data = await response.json();

                if (data.url) {
                    window.location.href = data.url;
                } else {
                    console.error('Payment Error:', data.error);
                    alert('Could not initiate payment. Please try again.');
                    button.innerText = originalText;
                    button.disabled = false;
                }
            } catch (error) {
                console.error('Network Error:', error);
                alert('Network error. Check console.');
                // Restore button text strictly based on type
                if (priceType === 'fighter-passport') {
                    document.getElementById('btn-fighter-passport').innerText = 'Get Passport';
                    document.getElementById('btn-fighter-passport').disabled = false;
                } else if (priceType === 'vip-concierge') {
                    document.getElementById('btn-vip-concierge').innerText = 'Join VIP';
                    document.getElementById('btn-vip-concierge').disabled = false;
                }
            }
        }

        const btnScoutFree = document.getElementById('btn-scout-free');
        const btnFighterPassport = document.getElementById('btn-fighter-passport');
        const btnVipConcierge = document.getElementById('btn-vip-concierge');

        if (btnScoutFree) {
            btnScoutFree.addEventListener('click', () => {
                const chatSection = document.getElementById('chatbot');
                if (chatSection) chatSection.scrollIntoView({ behavior: 'smooth' });
            });
        }

        // if (btnFighterPassport) {
        //     btnFighterPassport.addEventListener('click', () => handleCheckout('fighter-passport'));
        // }

        // if (btnVipConcierge) {
        //     btnVipConcierge.addEventListener('click', () => handleCheckout('vip-concierge'));
        // }
        // --- Text Modal Logic (Privacy & Terms) ---
        const textModal = document.getElementById('text-modal');
        const textModalTitle = document.getElementById('text-modal-title');
        const textModalContent = document.getElementById('text-modal-content');
        const closeTextModalBtn = document.getElementById('close-text-modal-btn');
        const linkPrivacy = document.getElementById('link-privacy');
        const linkTerms = document.getElementById('link-terms');

        const dummyPrivacy = `
            <p><strong>Last Updated: January 2026</strong></p>
            <p>Welcome to GymFinder.ai. We are committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy outlines how we collect, use, and safeguard your data when you use our website and services.</p>
            <h3>1. Information We Collect</h3>
            <p>We collect information you provide directly to us, such as when you search for gyms, create an account, or contact support. This may include your name, email address, location preferences, and fitness goals.</p>
            <h3>2. How We Use Your Information</h3>
            <p>We use your information to personalize your gym recommendations, process payments for our services, and improve the overall functionality of our platform.</p>
            <h3>3. Data Security</h3>
            <p>We implement industry-standard security measures to protect your data from unauthorized access, disclosure, or misuse. However, no method of transmission over the internet is 100% secure.</p>
        `;

        const dummyTerms = `
            <p><strong>Effective Date: January 2026</strong></p>
            <p>Please read these Terms of Service carefully before using GymFinder.ai. By accessing or using our services, you agree to be bound by these terms.</p>
            <h3>1. Acceptance of Terms</h3>
            <p>By using our website, you agree to comply with and be bound by these Terms of Service. If you do not agree, you may not use our services.</p>
            <h3>2. Use of Service</h3>
            <p>You agree to use our platform for lawful purposes only. You must not use our services to transmit any harmful code or interfere with the operation of the site.</p>
            <h3>3. Limitation of Liability</h3>
            <p>GymFinder.ai is not liable for any direct, indirect, incidental, or consequential damages arising from your use of our services or the gyms recommended by our platform.</p>
        `;

        function openTextModal(title, content) {
            textModalTitle.innerText = title;
            textModalContent.innerHTML = content;
            textModal.classList.remove('hidden');
            textModal.classList.add('flex');
            document.body.style.overflow = 'hidden'; // Prevent background scrolling
        }

        function closeTextModal() {
            textModal.classList.add('hidden');
            textModal.classList.remove('flex');
            document.body.style.overflow = ''; // Restore scrolling
        }

        if (linkPrivacy) {
            linkPrivacy.addEventListener('click', (e) => {
                e.preventDefault();
                openTextModal('Privacy Policy', dummyPrivacy);
            });
        }

        if (linkTerms) {
            linkTerms.addEventListener('click', (e) => {
                e.preventDefault();
                openTextModal('Terms of Service', dummyTerms);
            });
        }

        if (closeTextModalBtn) {
            closeTextModalBtn.addEventListener('click', closeTextModal);
        }

        if (textModal) {
            textModal.addEventListener('click', (e) => {
                if (e.target === textModal) {
                    closeTextModal();
                }
            });
        }

        // --- Redesigned Modal Logic ---
        {
            const closeModalMobile = document.getElementById('close-modal-mobile');
            const btnConciergeBook = document.getElementById('btn-concierge-book');
            const videoModal = document.getElementById('video-modal');

            function closeVideoModal() {
                videoModal.classList.add('hidden');
                videoModal.classList.remove('flex');
                const vid = document.getElementById('modal-video');
                if (vid) {
                    vid.pause();
                    vid.currentTime = 0;
                }

                // Reset State (New Overlay)
                if (window.resetModalState) window.resetModalState();
            }

            if (closeModalMobile) {
                closeModalMobile.addEventListener('click', closeVideoModal);
            }

            const closeModalBtn = document.getElementById('close-modal-btn');
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', closeVideoModal);
            }

            if (videoModal) {
                videoModal.addEventListener('click', (e) => {
                    if (e.target === videoModal) closeVideoModal();
                });
            }

            // Full Screen Modal Logic
            const videoModalFull = document.getElementById('video-modal-full');
            const closeFullBtn = document.getElementById('close-modal-full-btn');

            function closeFullModal() {
                if (!videoModalFull) return;
                videoModalFull.classList.add('hidden');
                videoModalFull.classList.remove('flex');
                const vidFull = document.getElementById('modal-video-full');
                if (vidFull) {
                    vidFull.pause();
                    vidFull.currentTime = 0;
                }
            }

            // VSL Trigger Logic (Hand-Verified Section)
            const vslTrigger = document.getElementById('vsl-trigger');
            if (vslTrigger) {
                vslTrigger.addEventListener('click', () => {
                    const vidFull = document.getElementById('modal-video-full');
                    const modalFull = document.getElementById('video-modal-full');
                    // Use specific source or extract from the trigger's video tag
                    const source = "https://cdn.shopify.com/videos/c/o/v/48ec1e59d63740a1bd3b81486969da95.mp4";

                    if (vidFull && modalFull) {
                        vidFull.src = source;
                        modalFull.classList.remove('hidden');
                        modalFull.classList.add('flex');
                        vidFull.play();
                    }
                });
            }


            if (closeFullBtn) closeFullBtn.addEventListener('click', closeFullModal);
            if (videoModalFull) {
                videoModalFull.addEventListener('click', (e) => {
                    if (e.target === videoModalFull) closeFullModal();
                });
            }

            if (btnConciergeBook) {
                btnConciergeBook.addEventListener('click', () => {
                    const gymName = document.getElementById('modal-title').innerText;
                    // Do NOT close the video modal immediately if we want to layer, 
                    // but usually we want to switch context. Let's close video modal for cleaner UI.
                    closeVideoModal();

                    // Populate Booking Modal
                    const bookingModal = document.getElementById('booking-modal');
                    const bookingGymInput = document.getElementById('booking-gym-name');

                    if (bookingGymInput) bookingGymInput.value = gymName;

                    if (bookingModal) {
                        bookingModal.style.display = 'flex';
                    }
                });
            }

            // New Ask AI Button Logic
            const btnAskAi = document.getElementById('btn-ask-ai');
            if (btnAskAi) {
                btnAskAi.addEventListener('click', () => {
                    const gymName = document.getElementById('modal-title').innerText;
                    closeVideoModal();

                    const chatSection = document.getElementById('chatbot');
                    if (chatSection) chatSection.scrollIntoView({ behavior: 'smooth' });

                    const chatInput = document.getElementById('chat-input');
                    if (chatInput) {
                        chatInput.value = `Tell me more about **${gymName}**`;
                        chatInput.focus();
                    }
                });
            }

            // Slide-to-Info Logic
            // Slide-to-Info Logic (New Overlay Method)
            const btnGetInfo = document.getElementById('btn-get-info');
            const btnInfoBack = document.getElementById('btn-info-back');
            const detailsOverlay = document.getElementById('full-screen-details');

            // Helper function for smooth volume fade
            function fadeVolume(videoElement, targetVolume, duration = 500) {
                if (!videoElement) return;

                const startVolume = videoElement.volume;
                const volumeChange = targetVolume - startVolume;
                const steps = 20; // Number of steps for smooth transition
                const stepDuration = duration / steps;
                let currentStep = 0;

                const fadeInterval = setInterval(() => {
                    currentStep++;
                    const progress = currentStep / steps;
                    // Ease-in-out for smoother transition
                    const easedProgress = progress < 0.5
                        ? 2 * progress * progress
                        : 1 - Math.pow(-2 * progress + 2, 2) / 2;

                    videoElement.volume = Math.max(0, Math.min(1, startVolume + (volumeChange * easedProgress)));

                    if (currentStep >= steps) {
                        clearInterval(fadeInterval);
                        videoElement.volume = targetVolume; // Ensure exact target
                    }
                }, stepDuration);
            }

            if (btnGetInfo && detailsOverlay) {
                btnGetInfo.addEventListener('click', () => {
                    // Slide in Overlay from Right
                    detailsOverlay.classList.remove('translate-x-full');

                    // Smoothly lower video volume
                    const modalVideo = document.getElementById('modal-video');
                    const modalVideoFull = document.getElementById('modal-video-full');
                    fadeVolume(modalVideo, 0.2, 500);
                    fadeVolume(modalVideoFull, 0.2, 500);
                });
            }

            if (btnInfoBack && detailsOverlay) {
                btnInfoBack.addEventListener('click', () => {
                    // Slide Overlay back to Right
                    detailsOverlay.classList.add('translate-x-full');

                    // Smoothly restore video volume
                    const modalVideo = document.getElementById('modal-video');
                    const modalVideoFull = document.getElementById('modal-video-full');
                    fadeVolume(modalVideo, 1.0, 500);
                    fadeVolume(modalVideoFull, 1.0, 500);
                });
            }

            // Function to reset modal state on close
            window.resetModalState = () => {
                const overlay = document.getElementById('full-screen-details');
                if (overlay) {
                    overlay.classList.add('translate-x-full');
                    // Optional: Reset scroll position
                    const content = overlay.querySelector('#modal-detailed-content');
                    if (content && content.parentNode) content.parentNode.scrollTop = 0;
                }
            };

            // Map and Save Actions
            const btnActionMap = document.getElementById('btn-action-map');
            const toast = document.getElementById('toast-notification');
            const toastMessage = document.getElementById('toast-message');
            let toastTimeout;

            function showToast(msg) {
                if (!toast || !toastMessage) return;

                // Reset animation
                clearTimeout(toastTimeout);
                toast.classList.remove('hidden');
                // Trigger reflow
                void toast.offsetWidth;

                toast.classList.remove('translate-y-10', 'opacity-0');
                toast.classList.add('flex', 'translate-y-0', 'opacity-100');
                toastMessage.textContent = msg;

                toastTimeout = setTimeout(() => {
                    toast.classList.remove('translate-y-0', 'opacity-100');
                    toast.classList.add('translate-y-10', 'opacity-0');
                    setTimeout(() => {
                        toast.classList.remove('flex');
                        toast.classList.add('hidden');
                    }, 300);
                }, 3000);
            }

            if (btnActionMap) {
                btnActionMap.addEventListener('click', () => {
                    const location = document.getElementById('modal-location').textContent.trim();
                    const title = document.getElementById('modal-title').textContent.trim();
                    const query = encodeURIComponent(`${title} ${location}`);
                    window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
                });
            }


            // Beta Unlock Logic
            document.addEventListener('DOMContentLoaded', () => {
                const unlockBtn = document.getElementById('unlock-btn');
                const betaModal = document.getElementById('beta-modal');
                const closeBetaBtn = document.getElementById('close-beta-modal');
                const joinBetaBtn = document.getElementById('join-beta-btn');
                const pricing = document.getElementById('pricing');

                // Helper to open modal
                const openBetaModal = () => {
                    if (betaModal) {
                        betaModal.classList.remove('hidden');
                        betaModal.classList.add('flex');
                    }
                };

                // Helper to close modal
                const closeBetaModal = () => {
                    if (betaModal) {
                        betaModal.classList.add('hidden');
                        betaModal.classList.remove('flex');
                    }
                };

                if (unlockBtn) {
                    unlockBtn.addEventListener('click', (e) => {
                        e.preventDefault(); // Prevent default link behavior if any
                        openBetaModal();
                    });
                }

                if (closeBetaBtn) {
                    closeBetaBtn.addEventListener('click', closeBetaModal);
                }

                if (betaModal) {
                    betaModal.addEventListener('click', (e) => {
                        if (e.target === betaModal) closeBetaModal();
                    });
                }

                if (joinBetaBtn) {
                    joinBetaBtn.addEventListener('click', () => {
                        closeBetaModal();
                        if (pricing) pricing.scrollIntoView({ behavior: 'smooth' });
                    });
                }

                // Video Rollover Logic (Delegated with Best Bits Preview)
                const gymContainer = document.getElementById('gyms');
                if (gymContainer) {
                    let activeCard = null;
                    let previewInterval;
                    let startTimeout;

                    const stopPreview = () => {
                        if (!activeCard) return;
                        const video = activeCard.querySelector('video');
                        if (video) {
                            video.classList.add('opacity-0');
                            video.pause();
                            // Immediately reset to start (removed the setTimeout delay)
                            video.currentTime = 0;
                        }
                        clearInterval(previewInterval);
                        clearTimeout(startTimeout);
                        activeCard = null;
                    };

                    gymContainer.addEventListener('mouseover', (e) => {
                        const card = e.target.closest('.gym-card');
                        if (!card) return;

                        // If we are already handling this card, avoid re-triggering logic on child elements
                        if (activeCard === card) return;

                        // If we moved directly from one card to another
                        if (activeCard && activeCard !== card) {
                            stopPreview();
                        }

                        activeCard = card;
                        const video = card.querySelector('video');
                        if (!video) return;

                        // Debounce start to avoid flickering
                        startTimeout = setTimeout(() => {
                            if (activeCard !== card) return;

                            video.currentTime = 0;
                            video.play().then(() => {
                                video.classList.remove('opacity-0');

                                // "Best Bits" Preview Logic: Start skipping after initial playback
                                // Delay the first skip to avoid the jarring double-skip glitch
                                setTimeout(() => {
                                    previewInterval = setInterval(() => {
                                        if (!video.paused) {
                                            if (video.currentTime + 5 >= video.duration) {
                                                video.currentTime = 0;
                                            } else {
                                                video.currentTime += 5;
                                            }
                                        }
                                    }, 1500); // Skip 5s every 1.5s
                                }, 2000); // Wait 2s before first skip

                            }).catch(() => { });
                        }, 50);
                    });

                    gymContainer.addEventListener('mouseout', (e) => {
                        const card = e.target.closest('.gym-card');
                        if (!card) return;

                        // If moving to a child element, do nothing
                        if (card.contains(e.relatedTarget)) return;

                        // Truly left the card
                        stopPreview();
                    });

                    // --- Gym Card Click Logic (Restore Modal) ---
                    gymContainer.addEventListener('click', (e) => {
                        const card = e.target.closest('.gym-card');
                        if (!card) return;

                        // Prevent if clicking a button inside the card (optional, but good UX)
                        if (e.target.closest('button') || e.target.closest('a')) return;

                        // Extract Data
                        const videoSrc = card.querySelector('video')?.src;
                        let title = card.querySelector('h3')?.innerText; // Changed to let
                        // Clean location text to extract just the city name if possible, or just raw text
                        const locationText = card.querySelector('.absolute.top-4.right-4')?.textContent.trim() || 'Thailand';

                        const rating = card.querySelector('.text-yellow-400')?.innerText.trim();
                        const desc = card.querySelector('p')?.innerText;

                        // Populate Modal
                        const modal = document.getElementById('video-modal');
                        const modalVideo = document.getElementById('modal-video');
                        const modalTitle = document.getElementById('modal-title');
                        const modalLocation = document.getElementById('modal-location');
                        const modalRating = document.getElementById('modal-rating');
                        const modalDesc = document.getElementById('modal-desc');

                        // Detailed Overlay Elements
                        const detailTitle = document.getElementById('detail-title');
                        const detailDesc = document.getElementById('detail-desc');
                        const detailPrograms = document.getElementById('detail-programs');
                        const detailAccom = document.getElementById('detail-accom');


                        if (modal && modalVideo) {
                            if (videoSrc) modalVideo.src = videoSrc;
                            if (title && modalTitle) modalTitle.innerText = title;
                            if (modalLocation) {
                                // Recreate the inner HTML for location
                                modalLocation.innerHTML = `<i data-lucide="map-pin" class="w-3 h-3"></i> ${locationText}`;
                            }
                            if (rating && modalRating) modalRating.innerText = rating;

                            // UNIFIED LOGIC: Delegate to the robust function
                            if (window.openVideoModalByName && title) {
                                const currentTime = card.querySelector('video')?.currentTime || 0;
                                window.openVideoModalByName(title, currentTime, videoSrc);
                            } else {
                                console.error("openVideoModalByName missing or no title found");
                                // Simple Fallback
                                if (modalVideo) modalVideo.src = videoSrc;
                                if (modal.classList) {
                                    modal.classList.remove('hidden');
                                    modal.classList.add('flex');
                                }
                            }
                            return; // Stop here, function handles the rest




                            // Show Modal
                            modal.classList.remove('hidden');
                            modal.classList.add('flex');

                            // Play Video
                            modalVideo.play().catch(() => { });

                            // Re-init generic icons in modal if needed
                            if (window.lucide) lucide.createIcons();

                            // Reset any overlay states
                            if (window.resetModalState) window.resetModalState();

                            // Trigger simulated live tracker
                            if (window.refreshLiveTracker) window.refreshLiveTracker();
                        }
                    });
                }
            });
        }
        // --- VIP Onboarding Modal Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const vipModal = document.getElementById('vip-onboarding-modal');
            const vipForm = document.getElementById('vip-onboarding-form');
            const closeVipModalBtn = document.getElementById('close-vip-modal-btn');

            // Check URL for payment success param
            function checkPaymentSuccess() {
                const urlParams = new URLSearchParams(window.location.search);
                if (urlParams.get('payment_success') === 'vip') {
                    openVipModal();
                    // Clean URL without refresh
                    const newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname;
                    window.history.replaceState({ path: newUrl }, '', newUrl);
                }
            }

            function openVipModal() {
                if (!vipModal) return;
                vipModal.classList.remove('hidden');
                vipModal.classList.add('flex');
                document.body.style.overflow = 'hidden';
            }

            function closeVipModal() {
                if (!vipModal) return;
                vipModal.classList.add('hidden');
                vipModal.classList.remove('flex');
                document.body.style.overflow = '';
            }

            if (closeVipModalBtn) {
                closeVipModalBtn.addEventListener('click', closeVipModal);
            }

            if (vipForm) {
                vipForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    // Mock submission
                    const formData = {
                        gym: document.getElementById('vip-gym-name').value,
                        training: document.getElementById('vip-training-type').value,
                        date: document.getElementById('vip-start-date').value,
                        notes: document.getElementById('vip-notes').value
                    };
                    console.log('VIP Request:', formData);
                    alert('Request Received! We will get to work on your booking immediately.');
                    closeVipModal();
                });
            }

            // Run check on load
            checkPaymentSuccess();
        });

        // Video Preview Limit Logic
        const PREVIEW_LIMIT = 10; // 10 seconds preview
        let hasShownUnlock = false;

        function hideUnlockOverlay() {
            const overlay = document.getElementById('video-unlock-overlay');
            if (overlay) {
                overlay.classList.add('opacity-0', 'pointer-events-none');
            }
        }

        function showUnlockOverlay() {
            const overlay = document.getElementById('video-unlock-overlay');
            const video = document.getElementById('modal-video');
            if (overlay && video) {
                overlay.classList.remove('opacity-0', 'pointer-events-none');
                video.pause();
                hasShownUnlock = true;
            }
        }

        // Attach listener for preview limit
        document.addEventListener('DOMContentLoaded', () => {
            const modalVideo = document.getElementById('modal-video');
            if (modalVideo) {
                modalVideo.addEventListener('timeupdate', () => {
                    if (modalVideo.currentTime >= PREVIEW_LIMIT && !hasShownUnlock) {
                        showUnlockOverlay();
                    }
                });
            }
        });

        // Global Helper for Chat Pills
        window.openBookingFor = (gymName) => {
            // Find the gym card in the DOM
            const cards = document.querySelectorAll('.gym-card');
            let found = false;

            for (const card of cards) {
                const title = card.querySelector('h3')?.innerText;
                if (title && title.toLowerCase().includes(gymName.toLowerCase())) {
                    // Simulate click to trigger existing modal logic
                    card.click();
                    found = true;
                    break;
                }
            }

            if (!found) {
                // Determine which modal system is active and show generic fallback
                // Or just default to booking modal if we really can't show details
                const bookingModal = document.getElementById('booking-modal');
                const bookingGymInput = document.getElementById('booking-gym-name');
                if (bookingModal && bookingGymInput) {
                    bookingGymInput.value = gymName;
                    bookingModal.style.display = 'flex';
                    bookingModal.classList.remove('hidden');
                }
            }
        };

        // NEW: Open Video Modal directly from Chat Name
        window.openVideoModalByName = (gymName, startTime = 0, overrideSrc = null) => {
            console.log("SCOUT: Opening modal for", gymName);
            // 1. Normalize
            const normalize = (str) => str.toLowerCase().replace(/muay|thai|gym|camp|\s|\.|-/g, '');
            const key = normalize(gymName);
            const gymProps = window.gymData ? window.gymData.find(g => normalize(g.name) === key || normalize(g.name).includes(key) || key.includes(normalize(g.name))) : null;

            // 2. Try to find Media from DOM Cards (Hybrid approach since images/videos are static)
            let videoSrc = overrideSrc || ''; // Use override if provided
            let locationText = 'Thailand';
            let ratingText = '5.0';
            let titleText = gymName;

            // Only scan DOM if we don't have a source yet, OR if we need to grab metadata (location/rating)
            // Even if we have overrideSrc, we might want to scan for the other textual metadata if it's not in gymProps.
            // But let's assume if we clicked, we passed the source, and we still want to find metadata.

            const cards = document.querySelectorAll('.gym-card');
            cards.forEach(card => {
                const title = card.querySelector('h3')?.innerText || '';
                const nTitle = normalize(title);
                if (nTitle === key || nTitle.includes(key) || key.includes(nTitle)) {
                    if (!videoSrc) videoSrc = card.querySelector('video')?.src; // Only fill if empty
                    locationText = card.querySelector('.absolute.top-4.right-4')?.textContent.trim() || locationText;
                    ratingText = card.querySelector('.text-yellow-400')?.innerText.trim() || ratingText;
                    titleText = title; // Use exact card title
                }
            });

            // If no DOM match, maybe use gymProps data if available? 
            // For now, if we found a match in gymData, use that name.
            if (gymProps) titleText = gymProps.name;

            // 3. Populate Modal
            const modal = document.getElementById('video-modal');
            const modalVideo = document.getElementById('modal-video');
            const modalTitle = document.getElementById('modal-title');
            const modalLocation = document.getElementById('modal-location');
            const modalRating = document.getElementById('modal-rating');
            const modalDesc = document.getElementById('modal-desc');

            // Detailed Overlay Elements
            const detailTitle = document.getElementById('detail-title');
            const detailDesc = document.getElementById('detail-desc');
            const detailPrograms = document.getElementById('detail-programs');
            const detailAccom = document.getElementById('detail-accom');
            const detailTags = document.getElementById('detail-tags');

            if (modal && modalVideo) {
                // Reset Unlock Overlay State
                hasShownUnlock = false;
                hideUnlockOverlay();

                // Prevent reload if source is same
                if (videoSrc && modalVideo.getAttribute('src') !== videoSrc) {
                    modalVideo.src = videoSrc;
                }

                if (modalTitle) modalTitle.innerText = titleText;
                if (modalLocation) modalLocation.innerHTML = `<i data-lucide="map-pin" class="w-3 h-3"></i> ${locationText}`;
                if (modalRating) modalRating.innerText = ratingText;

                // Rich Data Population
                if (gymProps) {
                    // 1. Overview Tab
                    if (modalDesc) modalDesc.innerText = gymProps['Summary'] || gymProps.description;
                    if (detailTitle) detailTitle.innerText = `About ${gymProps.name}`;
                    if (detailDesc) detailDesc.innerText = gymProps['Summary'] || gymProps.description;

                    // Recommended Badge
                    const badgeRec = document.getElementById('detail-recommended');
                    if (badgeRec) {
                        if (gymProps['Recommended']) badgeRec.classList.remove('hidden');
                        else badgeRec.classList.add('hidden');
                    }

                    // Stats Grid
                    const setText = (id, val) => {
                        const el = document.getElementById(id);
                        if (el) el.innerText = val || '--';
                    };

                    // Debugging: Log full gym object to see available fields
                    console.log("Gym Details Loaded:", gymProps);

                    // Restore email only for the Overview section as requested
                    const emailVal = gymProps['email'] || gymProps['E-Mail'] || gymProps['Email'] || gymProps['Email Address'] || gymProps['Contact Email'] || gymProps['e-mail'] || gymProps['Contact'];
                    setText('detail-email-display', emailVal || '--');
                    // Try 'Opening Hours' first, then 'Days Open' (handle variations)
                    setText('detail-open', gymProps['Opening Hours'] || gymProps['Days Open']);

                    // Language Pills
                    const langEl = document.getElementById('detail-language');
                    if (langEl) {
                        const langs = gymProps['Languages Spoken'] || gymProps['Language Spoken'] || gymProps['Language'] || gymProps['Languages'];
                        let langArray = [];
                        if (Array.isArray(langs)) langArray = langs;
                        else if (typeof langs === 'string') langArray = langs.split(',').map(s => s.trim());

                        if (langArray.length > 0) {
                            langEl.innerHTML = langArray.map(l =>
                                `<span class="inline-flex items-center px-1.5 py-0.5 rounded bg-zinc-800 border border-zinc-700 text-[10px] text-zinc-300 mr-1 mb-1">${l}</span>`
                            ).join('');
                        } else {
                            langEl.innerText = '--';
                        }
                    }

                    setText('detail-address-short', gymProps['City/Region']); // Keep short for grid

                    // New Fields
                    setText('detail-phone', gymProps['Phone'] || gymProps['Phone Number'] || gymProps['Contact'] || gymProps['Tel']);
                    setText('detail-address-full', gymProps['Address'] || gymProps['Full Address'] || gymProps['Location']);

                    // Tags
                    if (detailTags && gymProps['Gym Atmosphere']) {
                        detailTags.innerHTML = gymProps['Gym Atmosphere'].map(tag =>
                            `<span class="px-2 py-1 bg-zinc-800 text-xs text-zinc-300 rounded border border-zinc-700">${tag}</span>`
                        ).join('');
                    } else if (detailTags) {
                        detailTags.innerHTML = '';
                    }

                    // 2. Training Tab (Redesigned as Key Logistics)
                    const amenitiesVal = gymProps['Nearby Amenities'] || "Centrally located.";
                    const amenitiesContainer = document.getElementById('detail-logistics-amenities');
                    if (amenitiesContainer) {
                        amenitiesContainer.innerHTML = amenitiesVal.split('\n').filter(line => line.trim() !== '').map(line => `
                            <span class="inline-flex items-center gap-1.5 px-2.5 py-1.5 rounded-lg border border-zinc-800 bg-zinc-900/50 text-xs text-zinc-300">
                                ${line.trim()}
                            </span>
                        `).join('');
                    }
                    // Append 'Minutes' if value exists
                    const durationVal = gymProps['Class Duration'] ? `${gymProps['Class Duration']} Minutes` : '--';
                    setText('detail-logistics-duration', durationVal);

                    // Handle Price Record IDs (Airtable Linked Records)
                    // Handle Price Record IDs (Airtable Linked Records)
                    let priceVal = gymProps['Prices'];
                    const priceContainer = document.getElementById('detail-logistics-price');

                    if (priceContainer) {
                        if (!priceVal) {
                            priceContainer.innerHTML = '<span class="text-zinc-500 text-sm">Contact for Pricing</span>';
                        } else {
                            // If it's a string, split by newline/comma (if messy) or just render
                            // If it's an array, use it directly (assuming lookup values)
                            let prices = [];
                            if (Array.isArray(priceVal)) {
                                // Filter out record IDs if mixed
                                prices = priceVal.filter(p => !p.startsWith('rec'));
                            } else if (typeof priceVal === 'string') {
                                if (priceVal.startsWith('rec')) {
                                    prices = []; // Hide ID
                                } else {
                                    prices = priceVal.split('\n');
                                }
                            }

                            if (prices.length === 0) {
                                priceContainer.innerHTML = '<span class="text-zinc-500 text-sm">Contact for Pricing</span>';
                            } else {
                                priceContainer.innerHTML = prices.map(p => `
                                    <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-zinc-800 bg-zinc-900/50 text-xs font-medium text-zinc-300">
                                        ${p}
                                    </span>
                                `).join('');
                            }
                        }
                    }

                    setText('detail-logistics-accom', gymProps.accommodation || gymProps['Accommodation']);

                    // Handle Notes Visibility
                    const notesVal = gymProps['Notes'] || gymProps['Summary'] || "";
                    const notesContainer = document.getElementById('container-logistics-notes');
                    const notesText = document.getElementById('detail-logistics-notes');

                    if (notesVal) {
                        if (notesContainer) notesContainer.classList.remove('hidden');
                        if (notesText) notesText.innerText = notesVal;
                    } else {
                        if (notesContainer) notesContainer.classList.add('hidden');
                    }

                    // 3. Facilities Tab
                    const detailStyles = document.getElementById('detail-logistics-styles');
                    if (detailStyles) {
                        detailStyles.innerText = gymProps['Crowd'] || gymProps['crowd'] || "All Levels";
                    }

                    if (detailAccom) detailAccom.innerText = gymProps.accommodation;

                    const detailNearby = document.getElementById('detail-nearby');
                    if (detailNearby) detailNearby.innerText = gymProps['Nearby Amenities'] || "Centrally located near food and convenience stores.";

                    // Contact
                    setText('val-phone', gymProps['Phone']);
                    setText('val-email', '--');


                    // 4. Photos Tab
                    const detailPhotos = document.getElementById('detail-photos-grid');
                    if (detailPhotos && gymProps['Photos'] && Array.isArray(gymProps['Photos'])) {
                        // Ensure we have 6 images by repeating if necessary
                        let photos = [...gymProps['Photos']];
                        while (photos.length > 0 && photos.length < 6) {
                            photos = photos.concat(gymProps['Photos']);
                        }

                        detailPhotos.innerHTML = photos.slice(0, 6).map(photo => `
                            <button onclick="window.openLightbox('${photo.url}')" class="relative aspect-square overflow-hidden bg-zinc-900 group block w-full">
                                <img src="${photo.thumbnails?.large?.url || photo.url}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" loading="lazy" />
                                <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors"></div>
                            </button>
                        `).join('');
                    } else if (detailPhotos) {
                        detailPhotos.innerHTML = '<div class="col-span-full py-12 flex flex-col items-center justify-center text-zinc-500"><i data-lucide="image-off" class="w-8 h-8 mb-2 opacity-50"></i><p class="text-sm">No photos available yet</p></div>';
                    }

                    // Toggle Visibility of Phone/Email containers
                    const boxPhone = document.getElementById('detail-contact-phone');
                    const boxEmail = document.getElementById('detail-contact-email');
                    if (boxPhone) {
                        if (gymProps['Phone']) { boxPhone.classList.remove('hidden'); boxPhone.classList.add('flex'); }
                        else { boxPhone.classList.add('hidden'); boxPhone.classList.remove('flex'); }
                    }
                    if (boxEmail) {
                        boxEmail.classList.add('hidden');
                        boxEmail.classList.remove('flex');
                    }

                    const btnLinkInsta = document.getElementById('btn-link-insta');
                    const btnLinkFacebook = document.getElementById('btn-link-facebook');

                    if (btnLinkInsta) {
                        btnLinkInsta.href = gymProps['Instagram'] || '#';
                        if (!gymProps['Instagram']) btnLinkInsta.classList.add('opacity-50', 'pointer-events-none');
                        else btnLinkInsta.classList.remove('opacity-50', 'pointer-events-none');
                    }
                    if (btnLinkFacebook) {
                        const fbLink = gymProps['Facebook'] || gymProps['Facebook Messenger'] || gymProps['Messenger'] || '#';
                        btnLinkFacebook.href = fbLink;
                        if (!fbLink || fbLink === '#') btnLinkFacebook.classList.add('opacity-50', 'pointer-events-none');
                        else btnLinkFacebook.classList.remove('opacity-50', 'pointer-events-none');
                    }

                } else {
                    // Fallback
                    if (modalDesc) modalDesc.innerText = "Experience authentic Muay Thai training.";
                    if (detailDesc) detailDesc.innerText = "Experience authentic Muay Thai training.";
                }

                // Show Modal
                modal.classList.remove('hidden');
                modal.classList.add('flex');

                // Helper to play
                const playVideo = () => {
                    if (startTime && !isNaN(startTime)) {
                        modalVideo.currentTime = startTime;
                    }
                    modalVideo.muted = false;
                    modalVideo.play().catch(e => console.error("Play error:", e));
                };

                if (modalVideo.readyState >= 1) {
                    playVideo();
                } else {
                    modalVideo.addEventListener('loadedmetadata', playVideo, { once: true });
                }

                if (window.lucide) lucide.createIcons();
                if (window.resetModalState) window.resetModalState();
                if (window.switchTab) window.switchTab('overview');
            }
        };
    </script>
    <!-- Beta Info Modal -->
    <div id="beta-modal"
        class="fixed inset-0 z-[60] hidden items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-in">
        <div class="bg-zinc-900 border border-zinc-700/50 w-full max-w-lg rounded-3xl p-8 relative shadow-2xl">
            <button id="close-beta-modal"
                class="absolute top-4 right-4 text-zinc-500 hover:text-white transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <div class="text-center mb-6">
                <div
                    class="inline-flex items-center justify-center w-14 h-14 rounded-full bg-blue-600/20 text-blue-500 mb-4">
                    <i data-lucide="map" class="w-7 h-7"></i>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">We're currently in the ring... ü•ä</h3>
                <p class="text-zinc-400">We are hand-verifying 5-10 new gyms every week to ensure the data is 100%
                    accurate.</p>
            </div>

            <div class="bg-zinc-950 rounded-2xl p-6 border border-zinc-800 mb-8">
                <h4 class="text-lg font-bold text-white mb-4">$29 Founding Member Pass</h4>
                <ul class="space-y-3">
                    <li class="flex flex-col gap-1">
                        <div class="flex items-start gap-3">
                            <i data-lucide="check" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i>
                            <span class="text-zinc-300 text-sm">Full access to 200+ verified gyms (unblurred maps &
                                pricing).</span>
                        </div>
                    </li>
                    <li class="flex items-start gap-3">
                        <i data-lucide="check" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i>
                        <span class="text-zinc-300 text-sm">150 AI Scout Credits for deep-dive questions.</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i data-lucide="check" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i>
                        <span class="text-zinc-300 text-sm">Lock in 40% discount - pay just $29 at launch (normally
                            $49).</span>
                    </li>
                    <li class="flex items-start gap-3">
                        <i data-lucide="check" class="w-5 h-5 text-emerald-500 shrink-0 mt-0.5"></i>
                        <span class="text-zinc-300 text-sm">Vote on which city we scout next (Pai, Krabi, or
                            Issan).</span>
                    </li>
                </ul>
            </div>

            <button onclick="openExclusiveInviteModal()" id="join-beta-btn"
                class="w-full py-4 rounded-lg bg-blue-600 hover:bg-blue-500 text-white font-bold text-lg transition-all shadow-lg shadow-blue-900/40 hover:scale-[1.02]">
                Join Waitlist - Pay When We Launch
            </button>
        </div>
    </div>
    <!-- Booking Modal -->
    <!-- Booking Modal -->
    <div id="booking-modal" style="display: none;"
        class="fixed inset-0 z-[70] items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-in overflow-y-auto">
        <div
            class="bg-zinc-900 border border-zinc-700/50 w-full max-w-3xl rounded-3xl relative shadow-2xl my-8 flex flex-col md:flex-row overflow-hidden">
            <button id="close-booking-modal" onclick="document.getElementById('booking-modal').style.display='none';"
                class="absolute top-4 right-4 z-10 text-zinc-500 hover:text-white transition-colors">
                <i data-lucide="x" class="w-6 h-6"></i>
            </button>

            <!-- Left Side: Header & Info -->
            <div
                class="w-full md:w-1/3 bg-zinc-950/50 p-8 flex flex-col justify-center items-center text-center border-b md:border-b-0 md:border-r border-zinc-800">
                <div
                    class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-emerald-600/20 text-emerald-500 mb-6">
                    <i data-lucide="calendar-check" class="w-8 h-8"></i>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">Book Your Session</h3>
                <p class="text-sm text-zinc-400 leading-relaxed">Secure your spot with our verified partner. We'll
                    handle the coordination for you.</p>

                <div class="mt-8 flex items-center gap-2 text-xs text-zinc-500">
                    <i data-lucide="shield-check" class="w-4 h-4 text-emerald-500"></i>
                    <span>Verified Gym Partner</span>
                </div>
            </div>

            <!-- Right Side: Form -->
            <div class="w-full md:w-2/3 p-6 md:p-8">
                <form id="booking-form" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label
                                class="block text-zinc-400 text-xs font-bold uppercase tracking-wider mb-2">Name</label>
                            <input type="text" id="booking-name" required placeholder="Your Full Name"
                                class="w-full bg-zinc-950 text-white border border-zinc-800 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500">
                        </div>
                        <div>
                            <label
                                class="block text-zinc-400 text-xs font-bold uppercase tracking-wider mb-2">Email</label>
                            <input type="email" id="booking-email" required placeholder="name@example.com"
                                class="w-full bg-zinc-950 text-white border border-zinc-800 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500">
                        </div>
                    </div>

                    <div>
                        <label class="block text-zinc-400 text-xs font-bold uppercase tracking-wider mb-2">Gym
                            Name</label>
                        <input type="text" id="booking-gym-name" readonly
                            class="w-full bg-zinc-950 text-zinc-300 border border-zinc-800 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 cursor-not-allowed">
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label
                                class="block text-zinc-400 text-xs font-bold uppercase tracking-wider mb-2">Date</label>
                            <input type="date" required
                                class="w-full bg-zinc-950 text-white border border-zinc-800 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 appearance-none">
                        </div>
                        <div>
                            <label
                                class="block text-zinc-400 text-xs font-bold uppercase tracking-wider mb-2">Time</label>
                            <input type="time" required
                                class="w-full bg-zinc-950 text-white border border-zinc-800 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 appearance-none">
                        </div>
                    </div>

                    <div>
                        <label class="block text-zinc-400 text-xs font-bold uppercase tracking-wider mb-2">Training
                            Type</label>
                        <select required
                            class="w-full bg-zinc-950 text-white border border-zinc-800 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 appearance-none">
                            <option value="Drop-in">Drop-in Session</option>
                            <option value="Private">Private 1-on-1</option>
                            <option value="Weekly">Weekly Pass</option>
                            <option value="Monthly">Monthly Package</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-zinc-400 text-xs font-bold uppercase tracking-wider mb-2">Special
                            Requests
                            / Notes</label>
                        <textarea id="booking-notes" rows="3"
                            placeholder="Tell us about your level or specific goals..."
                            class="w-full bg-zinc-950 text-white border border-zinc-800 rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 appearance-none resize-none"></textarea>
                    </div>

                    <button type="submit"
                        class="w-full py-4 mt-4 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white font-bold text-lg transition-all shadow-lg shadow-emerald-900/40 hover:scale-[1.02] flex items-center justify-center gap-2">
                        <span>Proceed to Payment</span>
                        <span class="bg-black/20 px-2 py-0.5 rounded text-sm">$15.00</span>
                    </button>

                    <p class="text-center text-xs text-zinc-500 mt-2">
                        <i data-lucide="lock" class="w-3 h-3 inline mr-1"></i> Secure SSL Payment
                    </p>
                    <p class="text-center text-xs text-zinc-400 mt-2 px-8">
                        *Booking is subject to availability and cannot be guaranteed. Our agent will confirm exact times
                        with the gym.
                    </p>
                </form>
            </div>
        </div>

        <script>
            document.getElementById('booking-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const btn = e.target.querySelector('button[type="submit"]');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="animate-spin" data-lucide="loader-2"></i> Processing...';
                btn.disabled = true;
                lucide.createIcons();

                const name = document.getElementById('booking-name').value;
                const email = document.getElementById('booking-email').value;
                const gymName = document.getElementById('booking-gym-name').value;
                const date = e.target.querySelector('input[type="date"]').value;
                const time = e.target.querySelector('input[type="time"]').value;
                const type = e.target.querySelector('select').value;
                const notes = document.getElementById('booking-notes').value;

                try {
                    // 1. Record the booking intent to Airtable (so Agent knows details)
                    const response = await fetch('/api/record-booking', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            name,
                            email,
                            gymName,
                            date,
                            time,
                            trainingType: type,
                            notes
                        })
                    });

                    if (response.ok) {
                        // 2. Redirect to the Static Stripe Payment Link
                        window.location.href = "https://buy.stripe.com/28E00k5E8c0B7gc8G23ks00";
                    } else {
                        const err = await response.json();
                        console.warn("Booking record failed:", err);
                        alert('Error: ' + (err.error || 'Could not save booking details. Please checks Logs.'));
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    }
                } catch (error) {
                    console.error('Booking Error:', error);
                    alert('Something went wrong. Please try again.');
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            });
        </script>
        <!-- Privacy & Terms Logic -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const privacyLink = document.getElementById('link-privacy');
                const termsLink = document.getElementById('link-terms');
                const textModal = document.getElementById('text-modal');
                const modalTitle = document.getElementById('text-modal-title');
                const modalContent = document.getElementById('text-modal-content');
                const closeBtn = document.getElementById('close-text-modal-btn');

                const privacyPolicyText = `
                <h3 class="text-xl text-white font-bold mb-2">1. Introduction</h3>
                <p>Welcome to Fightlore+. We value your privacy and are committed to protecting your personal data.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">2. Data Collection</h3>
                <p>We collect information you provide directly to us, such as when you create an account, subscribe to our newsletter, or contact us for support.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">3. Use of Information</h3>
                <p>We use the information we collect to provide, maintain, and improve our services, including to process transactions and send you related information.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">4. Sharing of Information</h3>
                <p>We do not share your personal information with third parties except as described in this policy or with your consent.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">5. Security</h3>
                <p>We take reasonable measures to help protect information about you from loss, theft, misuse and unauthorized access.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">6. Contact Us</h3>
                <p>If you have any questions about this Privacy Policy, please contact us at infofightlore@gmail.com.</p>
            `;

                const termsOfServiceText = `
                <h3 class="text-xl text-white font-bold mb-2">1. Acceptance of Terms</h3>
                <p>By accessing or using our services, you agree to be bound by these Terms of Service.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">2. Description of Service</h3>
                <p>Fightlore+ provides a platform for discovering and booking Muay Thai gyms in Thailand.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">3. User Accounts</h3>
                <p>You are responsible for maintaining the confidentiality of your account password and for all activities that occur under your account.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">4. User Conduct</h3>
                <p>You agree not to use the services for any unlawful purpose or in any way that violates these Terms.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">5. Termination</h3>
                <p>We may terminate or suspend your access to our services immediately, without prior notice or liability, for any reason whatsoever.</p>
                <h3 class="text-xl text-white font-bold mb-2 mt-4">6. Changes to Terms</h3>
                <p>We reserve the right to modify these terms at any time. We will provide notice of any significant changes.</p>
            `;

                function openTextModal(title, content) {
                    if (textModal && modalTitle && modalContent) {
                        modalTitle.textContent = title;
                        modalContent.innerHTML = content;
                        textModal.classList.remove('hidden');
                        textModal.classList.add('flex');
                        document.body.classList.add('overflow-hidden');
                    }
                }

                function closeTextModal() {
                    if (textModal) {
                        textModal.classList.add('hidden');
                        textModal.classList.remove('flex');
                        document.body.classList.remove('overflow-hidden');
                    }
                }

                if (privacyLink) {
                    privacyLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        openTextModal('Privacy Policy', privacyPolicyText);
                    });
                }

                if (termsLink) {
                    termsLink.addEventListener('click', (e) => {
                        e.preventDefault();
                        openTextModal('Terms of Service', termsOfServiceText);
                    });
                }

                if (closeBtn) {
                    closeBtn.addEventListener('click', closeTextModal);
                }

                if (textModal) {
                    textModal.addEventListener('click', (e) => {
                        if (e.target === textModal) {
                            closeTextModal();
                        }
                    });
                }
            });
        </script>
        <!-- Waitlist Modal (Global Overlay) -->
        <div id="waitlist-card"
            class="hidden fixed inset-0 z-[100] items-center justify-center bg-black/80 backdrop-blur-md animate-fade-in">
            <div
                class="relative w-full max-w-md p-6 mx-4 bg-[#050505] border border-zinc-800 rounded-3xl shadow-2xl animate-scale-up">

                <div class="flex flex-col items-center text-center gap-4 mb-8">
                    <div
                        class="w-14 h-14 rounded-full bg-blue-500/10 flex items-center justify-center border border-blue-500/20 mb-2 shadow-lg shadow-blue-500/10">
                        <i data-lucide="map" class="w-7 h-7 text-blue-400"></i>
                    </div>
                    <div>
                        <h4 class="text-white font-bold text-2xl tracking-tight mb-2">You've reached the edge of the
                            map.</h4>
                        <p class="text-zinc-400 text-sm leading-relaxed max-w-[320px] mx-auto">
                            Drop your email to join the <span class="text-white font-medium">Founding 500</span>. You'll
                            get an invite to the full Black Book at <span class="text-white font-medium">50% off
                                ($29)</span> when we go live. No credit card needed today.
                        </p>
                    </div>
                </div>

                <form class="space-y-4" id="waitlist-form">
                    <div class="space-y-3">
                        <div class="relative group">
                            <i
                                class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-zinc-500 group-focus-within:text-blue-400 transition-colors"></i>
                            <input type="text" id="waitlist-name" placeholder="Enter your full name"
                                class="w-full bg-zinc-900 border border-zinc-800 text-white text-base pl-12 pr-4 py-4 rounded-xl focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 transition-all placeholder-zinc-600">
                        </div>
                        <div class="relative group">
                            <i
                                class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-zinc-500 group-focus-within:text-blue-400 transition-colors"></i>
                            <input type="email" id="waitlist-email" required placeholder="Enter your email"
                                class="w-full bg-zinc-900 border border-zinc-800 text-white text-base pl-12 pr-4 py-4 rounded-xl focus:outline-none focus:border-blue-500/50 focus:ring-1 focus:ring-blue-500/20 transition-all placeholder-zinc-600">
                        </div>
                    </div>

                    <button type="submit" id="waitlist-btn"
                        class="w-full bg-white hover:bg-zinc-200 text-black font-bold text-lg py-4 rounded-xl transition-all flex items-center justify-center gap-2 shadow-lg shadow-white/5 transform active:scale-[0.99] mt-2">
                        <span>Join the Black Book</span>
                        <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </button>
                </form>

                <p id="waitlist-success"
                    class="hidden text-emerald-400 text-sm font-bold mt-4 text-center bg-emerald-500/10 py-2 rounded-lg border border-emerald-500/20">
                    <i data-lucide="check-circle" class="w-4 h-4 inline mr-1"></i> Access Granted. Welcome to the inner
                    circle.
                </p>

                <div class="text-center mt-6 pt-6 border-t border-zinc-900">
                    <p class="text-[11px] text-zinc-600 tracking-wide uppercase font-medium">Limited spots available for
                        beta access</p>
                </div>
            </div>
        </div>

        <script>
            document.getElementById('waitlist-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('waitlist-name').value;
                const email = document.getElementById('waitlist-email').value;
                const btn = document.getElementById('waitlist-btn');

                const originalText = btn.innerHTML;
                btn.innerHTML = `<i data-lucide="loader" class="w-5 h-5 animate-spin"></i> Securing Spot...`;
                btn.disabled = true;
                btn.classList.add('opacity-80', 'cursor-not-allowed');

                try {
                    const res = await fetch('/api/waitlist', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email, name })
                    });

                    if (res.ok) {
                        btn.innerHTML = `<i data-lucide="check" class="w-5 h-5"></i> Saved`;
                        btn.classList.replace('bg-white', 'bg-emerald-500');
                        btn.classList.replace('text-black', 'text-white');
                        btn.classList.replace('hover:bg-zinc-200', 'hover:bg-emerald-600');

                        document.getElementById('waitlist-success').classList.remove('hidden');

                        // Create confetti effect or nice feedback
                        if (lucide) lucide.createIcons();
                    } else {
                        alert('Something went wrong. Please try again.');
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                        btn.classList.remove('opacity-80', 'cursor-not-allowed');
                    }
                } catch (error) {
                    console.error(error);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    btn.classList.remove('opacity-80', 'cursor-not-allowed');
                }
            });
        </script>
        <!-- Founding 500 Waitlist Modal -->




        <script>
            // Modal Logic
            let foundingForm, foundingEmail, foundingContent, foundingSuccess, confirmedEmailSpan, foundingSubmitBtn;

            document.addEventListener('DOMContentLoaded', () => {
                foundingForm = document.getElementById('founding-form');
                foundingEmail = document.getElementById('founding-email');
                foundingContent = document.getElementById('founding-content');
                foundingSuccess = document.getElementById('founding-success');
                confirmedEmailSpan = document.getElementById('confirmed-email');
                foundingSubmitBtn = document.getElementById('founding-submit-btn');

                // Attach Submit Handler inside DOMContentLoaded
                if (foundingForm) {
                    foundingForm.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const email = foundingEmail.value;
                        const name = document.getElementById('founding-name').value;
                        if (!email || !name) return;

                        // Loading State
                        const originalBtnContent = foundingSubmitBtn.innerHTML;
                        foundingSubmitBtn.innerHTML = '<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i>';
                        foundingSubmitBtn.disabled = true;

                        try {
                            const response = await fetch('/api/waitlist', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ email: email, name: name })
                            });

                            const data = await response.json().catch(() => ({ error: 'Generic Server Error (Status: ' + response.status + ')' }));
                            console.log('Waitlist Response:', data);

                            if (response.ok) {
                                if (confirmedEmailSpan) confirmedEmailSpan.textContent = email;
                                if (foundingForm) foundingForm.classList.add('hidden');
                                // Also hide the feature list and title if they are outside the form
                                // Actually, let's just show the success state
                                if (foundingSuccess) {
                                    foundingSuccess.classList.remove('hidden');
                                    foundingSuccess.classList.add('flex');
                                }

                                foundingForm.reset();
                                foundingSubmitBtn.innerHTML = originalBtnContent;
                                foundingSubmitBtn.disabled = false;

                                if (window.lucide) lucide.createIcons();
                            } else {
                                alert(data.error || 'Something went wrong. Please try again.');
                                foundingSubmitBtn.innerHTML = originalBtnContent;
                                foundingSubmitBtn.disabled = false;
                            }
                        } catch (error) {
                            console.error('Fetch Error:', error);
                            alert('Network error or server is down. Please check your connection.');
                            foundingSubmitBtn.innerHTML = originalBtnContent;
                            foundingSubmitBtn.disabled = false;
                        }
                    });
                }

                // Catch-all: Find all Waitlist buttons and attach listener
                const buttons = document.querySelectorAll('button');
                buttons.forEach(btn => {
                    // EXCLUDE the actual submit button inside the modal from this catch-all
                    if (btn.id === 'founding-submit-btn' || btn.id === 'waitlist-btn') return;

                    if (btn.innerText.toLowerCase().includes('waitlist') || btn.innerText.toLowerCase().includes('early access')) {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            e.stopPropagation();
                            openExclusiveInviteModal();
                        });
                    }
                });
            });

            window.openExclusiveInviteModal = function () {
                const modal = document.getElementById('exclusive-invite-modal');
                if (modal) {
                    modal.style.setProperty('display', 'flex', 'important');
                    modal.style.setProperty('visibility', 'visible', 'important');
                    modal.style.setProperty('opacity', '1', 'important');
                    modal.style.setProperty('z-index', '2147483647', 'important');
                    document.body.style.overflow = 'hidden';
                }
            }

            window.closeExclusiveInviteModal = function () {
                const modal = document.getElementById('exclusive-invite-modal');
                if (modal) {
                    modal.style.setProperty('display', 'none', 'important');
                    document.body.style.overflow = '';
                    setTimeout(() => {
                        if (foundingForm) foundingForm.classList.remove('hidden');
                        if (foundingSuccess) {
                            foundingSuccess.classList.add('hidden');
                            foundingSuccess.classList.remove('flex');
                        }
                    }, 300);
                }
            }

            window.addEventListener('click', (e) => {
                const modal = document.getElementById('exclusive-invite-modal');
                if (modal && e.target === modal) {
                    closeExclusiveInviteModal();
                }
            });
        </script>
</body>

</html>